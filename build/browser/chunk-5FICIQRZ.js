import{a as J}from"./chunk-3ICLOKWM.js";import{a as N,b as B}from"./chunk-AWQM7IIM.js";import{a as $,b as H,c as q}from"./chunk-VMKVCHVW.js";import{a as W}from"./chunk-IJB3HI4L.js";import{a as z,b as A}from"./chunk-MNJUUXAV.js";import{c as G}from"./chunk-Y2GQIFGB.js";import"./chunk-6C43PQNK.js";import"./chunk-SGGM3K3A.js";import{b as F,e as R,i as L,w as j}from"./chunk-LTEV2KH7.js";import{i as V}from"./chunk-NKZL4UVF.js";import{$b as I,Fb as v,Hb as p,Ib as c,Oa as o,Pc as M,Qc as E,Rc as O,Ub as b,Wb as u,Xb as x,Yb as S,Yc as D,Za as _,_b as P,ac as T,bc as w,db as C,ha as g,hc as k,ia as f,ib as h,v as y,vb as d,wb as a,xb as r,yb as m}from"./chunk-S4NM23YD.js";import"./chunk-CSTXWUWE.js";var Q=()=>[];function U(n,t){if(n&1){let e=v();a(0,"div",23),u(1),a(2,"button",24),p("click",function(){let s=g(e).$implicit,l=c();return f(l.closeToast(s))}),u(3,"\xD7"),r()()}if(n&2){let e=t.$implicit;b("show",e.visible),d("ngClass",e.type),o(),S(" ",e.message," ")}}function X(n,t){if(n&1&&(a(0,"div",25),m(1,"i",26),u(2),r()),n&2){let e=c();o(2),S(" ",e.error," ")}}function Y(n,t){n&1&&m(0,"mat-progress-spinner",27)}function Z(n,t){if(n&1){let e=v();a(0,"button",35),p("click",function(){g(e);let s=c().$implicit,l=c(2);return f(l.supprimerSousNature(s.sousNature))}),m(1,"i",36),r()}}function ee(n,t){if(n&1){let e=v();a(0,"tr")(1,"td"),u(2),r(),a(3,"td"),u(4),r(),a(5,"td"),u(6),r(),a(7,"td"),u(8),r(),a(9,"td")(10,"div",31)(11,"button",32),p("click",function(){let s=g(e).$implicit,l=c(2);return f(l.updateSousNature(s.sousNature,s.sousNature.idNature))}),m(12,"i",33),r(),h(13,Z,2,0,"button",34),r()()()}if(n&2){let e=t.$implicit,i=c(2);o(2),x(e.sousNature.idSousNature),o(2),x(e.sousNature.nomSousNature),o(2),x(i.categorieMap[e.nature.typeNature]),o(2),x(e.sousNature.detailSousNature),o(5),d("ngIf",e.sousNature.idSousNature>0)}}function te(n,t){if(n&1&&(a(0,"table",28)(1,"thead",29)(2,"tr")(3,"th"),u(4,"ID"),r(),a(5,"th"),u(6,"Nom"),r(),a(7,"th"),u(8,"Cat\xE9gorie"),r(),a(9,"th"),u(10,"D\xE9tail"),r(),a(11,"th"),u(12,"Actions"),r()()(),a(13,"tbody"),h(14,ee,14,5,"tr",30),r()()),n&2){let e=c();o(14),d("ngForOf",e.sousNature_natures)}}function ie(n,t){if(n&1){let e=v();a(0,"li",40)(1,"a",41),p("click",function(s){let l=g(e).index;return c(2).goToPage(l+1),f(s.preventDefault())}),u(2),r()()}if(n&2){let e=t.index,i=c(2);b("active",i.pageIndex===e+1),o(2),S(" ",e+1," ")}}function re(n,t){if(n&1){let e=v();a(0,"div",37)(1,"div")(2,"p",38),u(3),r()(),a(4,"nav")(5,"ul",39)(6,"li",40)(7,"a",41),p("click",function(s){return g(e),c().previousPage(),f(s.preventDefault())}),m(8,"i",42),r()(),h(9,ie,3,3,"li",43),a(10,"li",40)(11,"a",41),p("click",function(s){return g(e),c().nextPage(),f(s.preventDefault())}),m(12,"i",44),r()()()()()}if(n&2){let e=c();o(3),P(" Page ",e.pageIndex," sur ",e.totalPages," (",e.total," nature(s) au total) "),o(3),b("disabled",e.pageIndex===1),o(3),d("ngForOf",k(8,Q).constructor(e.totalPages)),o(),b("disabled",e.pageIndex===e.totalPages)}}var K=class n{constructor(t,e,i,s,l){this.natureService=t;this.sousNatureService=e;this.globalFonctionService=i;this.router=s;this.dialog=l}error=null;pageIndex=1;pageSize=10;total=0;totalPages=1;Math=Math;actifOnly=!1;searchTerm="";isLoading=!0;natures=[];sousNatures=[];newSousNatures=[];typeCategorieList=Object.entries($).map(([t,e])=>({key:t,label:e}));categorieMap={};sousNature_natures=[];toasts=[];showToast(t,e="success"){let i={message:t,type:e,visible:!1};this.toasts.push(i),requestAnimationFrame(()=>{i.visible=!0}),i.timeout=setTimeout(()=>this.closeToast(i),3e3)}closeToast(t){clearTimeout(t.timeout),t.visible=!1,setTimeout(()=>{this.toasts=this.toasts.filter(e=>e!==t)},400)}ngOnInit(){this.categorieMap=this.typeCategorieList.reduce((t,e)=>(t[e.key]=e.label,t),{}),this.loadPageData()}loadPageData(){this.isLoading=!0,y({sousNatures:this.sousNatureService.listSousNatures(this.pageIndex,this.pageSize),natures:this.natureService.listNatures(1,1e3)}).subscribe({next:({sousNatures:t,natures:e})=>{console.log("loadPageData = ",t,e),t&&t.success&&t.data&&e&&e.success&&e.data?(this.total=t.data.total,this.totalPages=t.data.total_pages,this.pageIndex=t.data.page,this.natures=e.data.base_natures.map(i=>H.fromResponse(i)),this.sousNatures=t.data.sous_natures.map(i=>N.fromResponse(i)),this.buildSousNatureNature()):(this.error=t?.message||"Erreur lors du chargement des natures",this.natures=[],this.sousNatures=[]),this.isLoading=!1}})}buildSousNatureNature(){console.log("buildSousNatureNature",{natures:this.natures,sousNatures:this.sousNatures}),this.sousNature_natures=this.sousNatures.map(t=>{let e=this.natures.find(i=>i.idNature===t.idNature);return{sousNature:t,nature:e??{}}})}goToPage(t){t>=1&&t<=this.totalPages&&(this.pageIndex=t,this.loadPageData())}previousPage(){this.pageIndex>1&&(this.pageIndex--,this.loadPageData())}nextPage(){this.pageIndex<this.totalPages&&(this.pageIndex++,this.loadPageData())}addSousNature(){this.router.navigate(["sous-natures/create"])}supprimerSousNature(t){this.dialog.open(W,{width:"350px",data:{title:"Confirmation",message:"Voulez-vous vraiment supprimer la sous-nature "+t.nomSousNature+" ?",cancel:"Non",valid:"Oui"}}).afterClosed().subscribe(i=>{i===!0&&this.sousNatureService.deleteSousNature(t).subscribe(s=>{this.showToast(["Suppression r\xE9ussie !"],"success"),this.loadPageData()},s=>{let l=[];l.push(s.error?.message||"Erreur inconnue."),this.showToast(l,"error")})})}updateSousNature(t,e){this.sousNatureService.setSousNatureToEdit(t),this.router.navigate(["sous-natures/edit"])}search(){if(this.searchTerm.trim().length===0){this.loadPageData();return}this.isLoading=!0,this.error=null,this.sousNatureService.searchSousNature(this.searchTerm).subscribe({next:t=>{t&&t.success&&t.data?(this.sousNatures=t.data.map(e=>N.fromResponse(e)),this.buildSousNatureNature(),this.total=this.natures.length,this.totalPages=1):(this.error=t?.message||"Aucune sous nature trouv\xE9e",this.natures=[]),this.isLoading=!1},error:t=>{this.error="Erreur lors de la recherche",this.isLoading=!1,console.error("Erreur:",t)}})}toggleActifOnly(){this.actifOnly=!this.actifOnly,this.pageIndex=1,this.loadPageData()}static \u0275fac=function(e){return new(e||n)(_(q),_(B),_(J),_(V),_(G))};static \u0275cmp=C({type:n,selectors:[["app-sous-natures"]],decls:30,vars:6,consts:[[1,"toast-container"],["class","toast",3,"ngClass","show",4,"ngFor","ngForOf"],[1,"row"],[1,"col-12"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"fas","fa-user-tie","mr-2"],[1,"card-tools"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus"],[1,"card-body"],[1,"row","mb-3"],[1,"col-md-6"],[1,"input-group"],["type","text","placeholder","Rechercher une sous-nature...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],[1,"input-group-append"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-search"],["class","alert alert-danger",4,"ngIf"],["mode","indeterminate","diameter","50","style","display: block; margin: 0 auto;",4,"ngIf"],["class","table table-bordered table-hover",4,"ngIf"],["class","d-flex justify-content-between align-items-center mt-3",4,"ngIf"],[1,"toast",3,"ngClass"],[1,"close-btn",3,"click"],[1,"alert","alert-danger"],[1,"fas","fa-exclamation-triangle"],["mode","indeterminate","diameter","50",2,"display","block","margin","0 auto"],[1,"table","table-bordered","table-hover"],[1,"thead-dark"],[4,"ngFor","ngForOf"],["role","group",1,"btn-group"],[1,"btn","btn-sm","btn-info","mr-1",3,"click"],[1,"fas","fa-edit"],["class","btn btn-sm btn-danger",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"fas","fa-trash"],[1,"d-flex","justify-content-between","align-items-center","mt-3"],[1,"text-muted","mb-0"],[1,"pagination","mb-0"],[1,"page-item"],["href","#",1,"page-link",3,"click"],[1,"fas","fa-chevron-left"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"fas","fa-chevron-right"]],template:function(e,i){e&1&&(a(0,"div",0),h(1,U,4,4,"div",1),r(),a(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h2",6),m(7,"i",7),a(8,"b"),u(9," Sous-Nature "),r(),u(10," - "),a(11,"i"),u(12,"Listing"),r(),u(13," - "),r(),a(14,"div",8)(15,"button",9),p("click",function(){return i.addSousNature()}),m(16,"i",10),u(17," Nouvelle Sous-Nature "),r()()(),a(18,"div",11)(19,"div",12)(20,"div",13)(21,"div",14)(22,"input",15),w("ngModelChange",function(l){return T(i.searchTerm,l)||(i.searchTerm=l),l}),p("keyup.enter",function(){return i.search()}),r(),a(23,"div",16)(24,"button",17),p("click",function(){return i.search()}),m(25,"i",18),r()()()()(),h(26,X,3,1,"div",19)(27,Y,1,0,"mat-progress-spinner",20)(28,te,15,1,"table",21)(29,re,13,9,"div",22),r()()()()),e&2&&(o(),d("ngForOf",i.toasts),o(21),I("ngModel",i.searchTerm),o(4),d("ngIf",i.error),o(),d("ngIf",i.isLoading),o(),d("ngIf",!i.isLoading&&!i.error),o(),d("ngIf",i.totalPages>1))},dependencies:[D,M,E,O,j,F,R,L,A,z],styles:[".table-responsive[_ngcontent-%COMP%]{border-radius:8px;overflow:hidden;box-shadow:0 4px 12px #1111111a}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#5d83a9;color:#fff;text-align:center}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.table-row-hover[_ngcontent-%COMP%]:hover{background-color:#f1f3f5;transition:background .25s ease}.toast-container[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;display:flex;flex-direction:column;gap:10px;z-index:9999}.toast[_ngcontent-%COMP%]{min-width:220px;padding:12px 16px;border-radius:6px;color:#fff;box-shadow:0 4px 12px #00000040;font-size:14px;display:flex;justify-content:space-between;align-items:center;opacity:0;transform:translate(100%);transition:transform .4s ease,opacity .4s ease}.toast.show[_ngcontent-%COMP%]{opacity:1;transform:translate(0)}.toast.success[_ngcontent-%COMP%]{background-color:#4caf50}.toast.error[_ngcontent-%COMP%]{background-color:#f44336}.toast[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;font-size:16px;line-height:1;cursor:pointer}"]})};export{K as SousNatures};
