import{b as y}from"./chunk-5LKF5AZK.js";import{a as J}from"./chunk-IJB3HI4L.js";import{a as C,b as H}from"./chunk-BUFLK7LZ.js";import{a as W,b as q}from"./chunk-MNJUUXAV.js";import{c as G}from"./chunk-Y2GQIFGB.js";import"./chunk-6C43PQNK.js";import"./chunk-SGGM3K3A.js";import{b as z,e as A,i as $,w as B}from"./chunk-LTEV2KH7.js";import{i as N}from"./chunk-NKZL4UVF.js";import{$b as T,Fb as x,Hb as d,Ib as m,Oa as s,Pc as V,Qc as D,Rc as F,Ub as b,Wb as o,Xb as _,Xc as R,Yb as v,Yc as L,Za as P,_b as S,ac as M,bc as w,db as E,ha as g,hc as I,ia as f,ib as h,kc as k,mc as O,vb as u,wb as i,xb as n,yb as p}from"./chunk-S4NM23YD.js";import"./chunk-CSTXWUWE.js";var Q=()=>[];function U(a,t){if(a&1){let e=x();i(0,"div",23),o(1),i(2,"button",24),d("click",function(){let l=g(e).$implicit,c=m();return f(c.closeToast(l))}),o(3,"\xD7"),n()()}if(a&2){let e=t.$implicit;b("show",e.visible),u("ngClass",e.type),s(),v(" ",e.message," ")}}function X(a,t){if(a&1&&(i(0,"div",25),p(1,"i",26),o(2),n()),a&2){let e=m();s(2),v(" ",e.error," ")}}function Y(a,t){a&1&&(i(0,"mat-progress-spinner",27)(1,"p"),o(2,"Chargement des projets..."),n()())}function Z(a,t){if(a&1){let e=x();i(0,"tr")(1,"td"),o(2),n(),i(3,"td"),o(4),n(),i(5,"td"),o(6),n(),i(7,"td"),o(8),n(),i(9,"td"),o(10),n(),p(11,"td"),i(12,"td"),o(13),k(14,"date"),n(),i(15,"td")(16,"div",30)(17,"button",31),d("click",function(){let l=g(e).$implicit,c=m(2);return f(c.updateProjet(l,!1))}),p(18,"i",32),o(19," Modifier "),n(),i(20,"button",33),d("click",function(){let l=g(e).$implicit,c=m(2);return f(c.updateProjet(l,!0))}),p(21,"i",34),o(22," Duppliquer "),n(),i(23,"button",35),d("click",function(){let l=g(e).$implicit,c=m(2);return f(c.supprimerProjet(l))}),p(24,"i",36),o(25," Supprimer "),n()()()()}if(a&2){let e=t.$implicit,r=m(2);s(2),_(e.idProjet),s(2),_(e.nomProjet),s(2),_(e.client_nom??""),s(2),_(r.typeProjetsMap[+e.typeProjet]||"Non d\xE9fini"),s(2),_(e.dureeProjet),s(3),_(O(14,6,e.created_at,"yyyy-MM-dd"))}}function ee(a,t){if(a&1&&(i(0,"table",28)(1,"thead")(2,"tr")(3,"th"),o(4,"ID"),n(),i(5,"th"),o(6,"Nom"),n(),i(7,"th"),o(8,"Client"),n(),i(9,"th"),o(10,"Type"),n(),i(11,"th"),o(12,"Dur\xE9e"),n(),i(13,"th"),o(14,"Statut"),n(),i(15,"th"),o(16,"Date de cr\xE9ation"),n(),i(17,"th"),o(18,"Actions"),n()()(),i(19,"tbody"),h(20,Z,26,9,"tr",29),n()()),a&2){let e=m();s(20),u("ngForOf",e.projets)}}function te(a,t){if(a&1){let e=x();i(0,"li",40)(1,"a",41),d("click",function(l){let c=g(e).index;return m(2).goToPage(c+1),f(l.preventDefault())}),o(2),n()()}if(a&2){let e=t.index,r=m(2);b("active",r.pageIndex===e+1),s(2),v(" ",e+1," ")}}function ie(a,t){if(a&1){let e=x();i(0,"div",37)(1,"div")(2,"p",38),o(3),n()(),i(4,"nav")(5,"ul",39)(6,"li",40)(7,"a",41),d("click",function(l){return g(e),m().previousPage(),f(l.preventDefault())}),p(8,"i",42),n()(),h(9,te,3,3,"li",43),i(10,"li",40)(11,"a",41),d("click",function(l){return g(e),m().nextPage(),f(l.preventDefault())}),p(12,"i",44),n()()()()()}if(a&2){let e=m();s(3),S(" Page ",e.pageIndex," sur ",e.totalPages," (",e.total," nature(s) au total) "),s(3),b("disabled",e.pageIndex===1),s(3),u("ngForOf",I(8,Q).constructor(e.totalPages)),s(),b("disabled",e.pageIndex===e.totalPages)}}var K=class a{constructor(t,e,r){this.router=t;this.dialog=e;this.projetsServices=r}error=null;pageIndex=1;pageSize=10;totalPages=1;total=0;Math=Math;isLoading=!0;actifOnly=!1;projets=[];searchTerm="";typeProjets=y;typeProjetsMap={};toasts=[];showToast(t,e="success"){let r={message:t,type:e,visible:!1};this.toasts.push(r),requestAnimationFrame(()=>{r.visible=!0}),r.timeout=setTimeout(()=>this.closeToast(r),3e3)}closeToast(t){clearTimeout(t.timeout),t.visible=!1,setTimeout(()=>{this.toasts=this.toasts.filter(e=>e!==t)},400)}ngOnInit(){this.typeProjetsMap=Object.fromEntries(y.map(t=>[t.id,t.name])),this.loadProjets()}loadProjets(){this.isLoading=!0,this.projetsServices.listProjets(this.pageIndex,this.pageSize,this.searchTerm,void 0,this.actifOnly).subscribe(t=>{t&&t.success&&t.data?(this.projets=t.data.projets.map(e=>C.fromResponse(e)),this.total=t.data.total,this.totalPages=t.data.total_pages,this.pageIndex=t.data.page):(this.error=t?.message||"Erreur lors du chargement des projets",this.projets=[]),this.isLoading=!1},t=>{this.error="Erreur lors du chargement des projets",console.error("Erreur:",t),this.isLoading=!1})}supprimerProjet(t){this.dialog.open(J,{width:"350px",data:{title:"Confirmation",message:"Voulez-vous vraiment supprimer le projet "+t.nomProjet+" ?",cancel:"Non",valid:"Oui"}}).afterClosed().subscribe(r=>{r===!0&&this.projetsServices.deleteProjet(t).subscribe(l=>{this.loadProjets()},l=>{let c=[];c.push(l.error?.message||"Erreur inconnue."),this.showToast(c,"error")})})}addProjet(){this.router.navigate(["projets/create"])}goToPage(t){t>=1&&t<=this.totalPages&&(this.pageIndex=t,this.loadProjets())}previousPage(){this.pageIndex>1&&(this.pageIndex--,this.loadProjets())}nextPage(){this.pageIndex<this.totalPages&&(this.pageIndex++,this.loadProjets())}updateProjet(t,e){this.projetsServices.setProjetToEdit(t,e),this.router.navigate(["projets/edit"])}search(){if(this.isLoading=!0,this.error=null,this.searchTerm.trim().length===0){console.log("search = ",this.searchTerm.trim().length),this.loadProjets();return}this.projetsServices.searchProjet(1,this.pageSize,this.searchTerm).subscribe({next:t=>{t&&t.success&&t.data?(this.projets=t.data.projets.map(e=>C.fromResponse(e)),this.total=this.projets.length,this.totalPages=1):(this.error=t?.message||"Aucun projet trouv\xE9e",this.projets=[]),this.isLoading=!1},error:t=>{this.error="Erreur lors de la recherche",this.isLoading=!1,console.error("Erreur:",t)}})}static \u0275fac=function(e){return new(e||a)(P(N),P(G),P(H))};static \u0275cmp=E({type:a,selectors:[["app-projets"]],decls:30,vars:6,consts:[[1,"toast-container"],["class","toast",3,"ngClass","show",4,"ngFor","ngForOf"],[1,"row"],[1,"col-12"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"fas","fa-project-diagram","mr-2"],[1,"card-tools"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus"],[1,"card-body"],[1,"row","mb-3"],[1,"col-md-6"],[1,"input-group"],["type","text","placeholder","Rechercher un projet...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],[1,"input-group-append"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-search"],["class","alert alert-danger",4,"ngIf"],["mode","indeterminate","diameter","50","style","display: block; margin: 0 auto;",4,"ngIf"],["class","table table-bordered table-hover",4,"ngIf"],["class","d-flex justify-content-between align-items-center mt-3",4,"ngIf"],[1,"toast",3,"ngClass"],[1,"close-btn",3,"click"],[1,"alert","alert-danger"],[1,"fas","fa-exclamation-triangle"],["mode","indeterminate","diameter","50",2,"display","block","margin","0 auto"],[1,"table","table-bordered","table-hover"],[4,"ngFor","ngForOf"],["role","group",1,"btn-group"],[1,"btn","btn-sm","btn-info",3,"click"],[1,"fas","fa-edit"],[1,"btn","btn-sm","btn-warning","mr-1",3,"click"],[1,"fas","fa-clone"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"fas","fa-trash"],[1,"d-flex","justify-content-between","align-items-center","mt-3"],[1,"text-muted","mb-0"],[1,"pagination","mb-0"],[1,"page-item"],["href","#",1,"page-link",3,"click"],[1,"fas","fa-chevron-left"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"fas","fa-chevron-right"]],template:function(e,r){e&1&&(i(0,"div",0),h(1,U,4,4,"div",1),n(),i(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h3",6),p(7,"i",7),i(8,"b"),o(9," Projet "),n(),o(10," - "),i(11,"i"),o(12,"Listing"),n(),o(13," - "),n(),i(14,"div",8)(15,"button",9),d("click",function(){return r.addProjet()}),p(16,"i",10),o(17," Nouveau projet "),n()()(),i(18,"div",11)(19,"div",12)(20,"div",13)(21,"div",14)(22,"input",15),w("ngModelChange",function(c){return M(r.searchTerm,c)||(r.searchTerm=c),c}),d("keyup.enter",function(){return r.search()}),n(),i(23,"div",16)(24,"button",17),d("click",function(){return r.search()}),p(25,"i",18),n()()()()(),h(26,X,3,1,"div",19)(27,Y,3,0,"mat-progress-spinner",20)(28,ee,21,1,"table",21)(29,ie,13,9,"div",22),n()()()()),e&2&&(s(),u("ngForOf",r.toasts),s(21),T("ngModel",r.searchTerm),s(4),u("ngIf",r.error),s(),u("ngIf",r.isLoading&&!r.error),s(),u("ngIf",!r.isLoading&&!r.error),s(),u("ngIf",r.totalPages>1))},dependencies:[L,V,D,F,B,z,A,$,q,W,R],styles:[".table-responsive[_ngcontent-%COMP%]{border-radius:8px;overflow:hidden;box-shadow:0 4px 12px #1111111a}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#5d83a9;color:#fff;text-align:center}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.table-row-hover[_ngcontent-%COMP%]:hover{background-color:#f1f3f5;transition:background .25s ease}.table[_ngcontent-%COMP%]{margin-bottom:0}.badge[_ngcontent-%COMP%]{font-size:.75em}.btn-sm[_ngcontent-%COMP%]{padding:.25rem .5rem;font-size:.875rem}.toast-container[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;display:flex;flex-direction:column;gap:10px;z-index:9999}.toast[_ngcontent-%COMP%]{min-width:220px;padding:12px 16px;border-radius:6px;color:#fff;box-shadow:0 4px 12px #00000040;font-size:14px;display:flex;justify-content:space-between;align-items:center;opacity:0;transform:translate(100%);transition:transform .4s ease,opacity .4s ease}.toast.show[_ngcontent-%COMP%]{opacity:1;transform:translate(0)}.toast.success[_ngcontent-%COMP%]{background-color:#4caf50}.toast.error[_ngcontent-%COMP%]{background-color:#f44336}.toast[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;font-size:16px;line-height:1;cursor:pointer}"]})};export{K as ProjetsComponent};
