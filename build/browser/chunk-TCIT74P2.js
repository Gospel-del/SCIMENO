import{a as ne}from"./chunk-B3DS4LGY.js";import{a as y,b as te,c as ie}from"./chunk-TND3ERBF.js";import{b as ee}from"./chunk-AWQM7IIM.js";import{a as Y,c as Z}from"./chunk-VMKVCHVW.js";import{a as W,b as z,e as B,f as q,g as G,i as J,j as U,n as H,o as K,p as Q,w as X}from"./chunk-LTEV2KH7.js";import{j as R,l as j}from"./chunk-NKZL4UVF.js";import{$b as E,Fb as b,Hb as _,Ib as d,Oa as o,Qc as F,Rc as A,Ub as x,Wb as l,Xb as v,Xc as D,Yb as g,Yc as $,Za as k,_b as T,ac as C,bc as N,db as P,ha as p,hc as M,ia as S,ib as f,ic as L,kc as V,mc as O,v as I,vb as u,wb as i,xb as n,yb as m}from"./chunk-S4NM23YD.js";import"./chunk-CSTXWUWE.js";var le=s=>["/scenarios/edit",s],oe=()=>[];function ce(s,t){if(s&1&&(i(0,"div",31),m(1,"i",32),l(2),n()),s&2){let e=d();o(2),g(" ",e.error," ")}}function de(s,t){s&1&&(i(0,"div",33),m(1,"i",34),i(2,"p"),l(3,"Chargement des sc\xE9narios..."),n()())}function ue(s,t){if(s&1){let e=b();i(0,"tr")(1,"td"),l(2),n(),i(3,"td"),l(4),n(),i(5,"td")(6,"span",39),l(7),n()(),i(8,"td"),l(9),n(),i(10,"td")(11,"span",40),l(12),n()(),i(13,"td")(14,"span",40),l(15),n()(),i(16,"td"),l(17),V(18,"date"),n(),i(19,"td")(20,"div",41)(21,"a",42),_("click",function(){let a=p(e).$implicit,c=d(2);return S(c.editScenario(a))}),m(22,"i",43),n(),i(23,"button",44),_("click",function(){let a=p(e).$implicit,c=d(2);return S(c.toggleScenarioStatus(a))}),m(24,"i",24),n(),i(25,"button",45),_("click",function(){let a=p(e).$implicit,c=d(2);return S(c.deleteScenario(a))}),m(26,"i",46),n()()()()}if(s&2){let e=t.$implicit;o(2),v(e.id_scenario),o(2),v(e.nom_scenario),o(3),v(e.getFormattedCoefficient()),o(2),v(e.description||"Aucune description"),o(2),x("badge-success",e.status)("badge-danger",!e.status),o(),g(" ",e.status?"Actif":"Supprim\xE9"," "),o(2),x("badge-success",e.actif)("badge-warning",!e.actif),o(),g(" ",e.actif?"Oui":"Non"," "),o(2),v(O(18,25,e.created_at,"dd/MM/yyyy")),o(4),u("routerLink",L(28,le,e.id_scenario)),o(2),x("btn-warning",e.actif)("btn-success",!e.actif),u("title",e.actif?"D\xE9sactiver":"Activer"),o(),x("fa-toggle-on",e.actif)("fa-toggle-off",!e.actif)}}function me(s,t){s&1&&(i(0,"div",47),m(1,"i",48),i(2,"p",49),l(3,"Aucun sc\xE9nario trouv\xE9"),n()())}function _e(s,t){if(s&1){let e=b();i(0,"li",53)(1,"a",54),_("click",function(a){let c=p(e).index;return d(3).goToPage(c+1),S(a.preventDefault())}),l(2),n()()}if(s&2){let e=t.index,r=d(3);x("active",r.currentPage===e+1),o(2),g(" ",e+1," ")}}function pe(s,t){if(s&1){let e=b();i(0,"div",50)(1,"div")(2,"p",51),l(3),n()(),i(4,"nav")(5,"ul",52)(6,"li",53)(7,"a",54),_("click",function(a){return p(e),d(2).previousPage(),S(a.preventDefault())}),m(8,"i",55),n()(),f(9,_e,3,3,"li",56),i(10,"li",53)(11,"a",54),_("click",function(a){return p(e),d(2).nextPage(),S(a.preventDefault())}),m(12,"i",57),n()()()()()}if(s&2){let e=d(2);o(3),T(" Page ",e.currentPage," sur ",e.totalPages," (",e.total," sc\xE9nario(s) au total) "),o(3),x("disabled",e.currentPage===1),o(3),u("ngForOf",M(8,oe).constructor(e.totalPages)),o(),x("disabled",e.currentPage===e.totalPages)}}function Se(s,t){if(s&1&&(i(0,"div")(1,"table",35)(2,"thead")(3,"tr")(4,"th"),l(5,"ID"),n(),i(6,"th"),l(7,"Nom du sc\xE9nario"),n(),i(8,"th"),l(9,"Coefficient de majoration"),n(),i(10,"th"),l(11,"Description"),n(),i(12,"th"),l(13,"Statut"),n(),i(14,"th"),l(15,"Actif"),n(),i(16,"th"),l(17,"Cr\xE9\xE9 le"),n(),i(18,"th"),l(19,"Actions"),n()()(),i(20,"tbody"),f(21,ue,27,30,"tr",36),n()(),f(22,me,4,0,"div",37)(23,pe,13,9,"div",38),n()),s&2){let e=d();o(21),u("ngForOf",e.scenarios),o(),u("ngIf",e.scenarios.length===0),o(),u("ngIf",e.totalPages>1)}}function fe(s,t){if(s&1&&(i(0,"option",60),l(1),n()),s&2){let e=t.$implicit;u("ngValue",e.id_scenario),o(),g(" ",e.nom_scenario," ")}}function ge(s,t){if(s&1&&(i(0,"div",31),m(1,"i",32),l(2),n()),s&2){let e=d(2);o(2),g(" ",e.linksError," ")}}function he(s,t){s&1&&(i(0,"div",33),m(1,"i",34),i(2,"p"),l(3,"Chargement des liens..."),n()())}function ve(s,t){if(s&1){let e=b();i(0,"tr")(1,"td"),l(2),n(),i(3,"td"),l(4),n(),i(5,"td"),l(6),n(),i(7,"td"),l(8),n(),i(9,"td")(10,"button",45),_("click",function(){let a=p(e).$implicit,c=d(3);return S(c.deleteScenarioSousNatureLink(a))}),m(11,"i",46),l(12," Supprimer "),n()()()}if(s&2){let e=t.$implicit,r=d(3);o(2),v(e.scenarioSousNature.id_scenario_sous_nature),o(2),v(e.scenario.nom_scenario||"N/A"),o(2),v(e.sousNature.nomSousNature||"N/A"),o(2),v(r.categorieMap[e.nature.typeNature]||"N/A")}}function xe(s,t){s&1&&(i(0,"div",47),m(1,"i",65),i(2,"p",49),l(3,"Aucun lien trouv\xE9"),n()())}function be(s,t){if(s&1){let e=b();i(0,"li",53)(1,"a",54),_("click",function(a){let c=p(e).index;return d(4).onLinksPageChange(c+1),S(a.preventDefault())}),l(2),n()()}if(s&2){let e=t.index,r=d(4);x("active",r.linksPageIndex===e+1),o(2),g(" ",e+1," ")}}function ke(s,t){if(s&1){let e=b();i(0,"div",66)(1,"ul",67)(2,"li",53)(3,"a",68),_("click",function(a){p(e);let c=d(3);return c.onLinksPageChange(c.linksPageIndex-1),S(a.preventDefault())}),l(4," \xAB "),n()(),f(5,be,3,3,"li",56),i(6,"li",53)(7,"a",69),_("click",function(a){p(e);let c=d(3);return c.onLinksPageChange(c.linksPageIndex+1),S(a.preventDefault())}),l(8," \xBB "),n()()(),i(9,"div",70)(10,"p",51),l(11),n()()()}if(s&2){let e=d(3);o(2),x("disabled",e.linksPageIndex===1),o(3),u("ngForOf",M(8,oe).constructor(e.linksTotalPages)),o(),x("disabled",e.linksPageIndex===e.linksTotalPages),o(5),T(" Page ",e.linksPageIndex," sur ",e.linksTotalPages," (",e.linksTotal," lien(s) au total) ")}}function Ee(s,t){if(s&1&&(i(0,"div")(1,"table",62)(2,"thead",63)(3,"tr")(4,"th"),l(5,"ID"),n(),i(6,"th"),l(7,"Sc\xE9nario"),n(),i(8,"th"),l(9,"Sous-Nature"),n(),i(10,"th"),l(11,"Cat\xE9gorie"),n(),i(12,"th"),l(13,"Actions"),n()()(),i(14,"tbody"),f(15,ve,13,4,"tr",36),n()(),f(16,xe,4,0,"div",37)(17,ke,12,9,"div",64),n()),s&2){let e=d(2);o(15),u("ngForOf",e.scenarioSousNatureElements),o(),u("ngIf",e.scenarioSousNatureElements.length===0),o(),u("ngIf",e.linksTotalPages>1)}}function Ce(s,t){if(s&1){let e=b();i(0,"div",6)(1,"div",7)(2,"div",8)(3,"label",58),l(4,"Filtrer par sc\xE9nario:"),n(),i(5,"select",59),_("ngModelChange",function(a){p(e);let c=d();return S(c.filterLinksByScenario(a))}),i(6,"option",60),l(7,"Tous les sc\xE9narios"),n(),f(8,fe,2,2,"option",61),n()()(),f(9,ge,3,1,"div",18)(10,he,4,0,"div",19)(11,Ee,18,3,"div",20),n()}if(s&2){let e=d();o(5),u("ngModel",e.selectedScenarioId),o(),u("ngValue",null),o(2),u("ngForOf",e.scenarios),o(),u("ngIf",e.linksError),o(),u("ngIf",e.linksLoading),o(),u("ngIf",!e.linksLoading&&!e.linksError)}}function Ne(s,t){if(s&1&&(i(0,"div",31),m(1,"i",32),l(2),n()),s&2){let e=d(2);o(2),g(" ",e.modalError," ")}}function ye(s,t){if(s&1){let e=b();i(0,"tr",105)(1,"td"),l(2),n(),i(3,"td"),l(4),n(),i(5,"td"),l(6),n(),i(7,"td")(8,"button",106),_("click",function(){let a=p(e).$implicit,c=d(3);return S(c.selectScenario(a))}),m(9,"i",107),l(10," S\xE9lectionner "),n()()()}if(s&2){let e=t.$implicit;o(2),v(e.id_scenario),o(2),v(e.nom_scenario),o(2),v(e.getFormattedCoefficient())}}function we(s,t){if(s&1&&(i(0,"div",100)(1,"div",101)(2,"table",102)(3,"thead",103)(4,"tr")(5,"th"),l(6,"ID"),n(),i(7,"th"),l(8,"Nom du sc\xE9nario"),n(),i(9,"th"),l(10,"Coefficient"),n(),i(11,"th"),l(12,"Action"),n()()(),i(13,"tbody"),f(14,ye,11,3,"tr",104),n()()()()),s&2){let e=d(2);o(14),u("ngForOf",e.filteredScenarios)}}function Ie(s,t){s&1&&(i(0,"div",108)(1,"small"),l(2,"Aucun sc\xE9nario trouv\xE9"),n()())}function Te(s,t){s&1&&(i(0,"small",109),m(1,"i",110),l(2," Sc\xE9nario s\xE9lectionn\xE9 "),n())}function Me(s,t){if(s&1&&(i(0,"div",111),m(1,"i",112),l(2),n()),s&2){let e=d(2);o(2),g(" ",e.sousNatureSearchTerm?"Aucune sous-nature trouv\xE9e":"Aucune sous-nature disponible"," ")}}function Pe(s,t){if(s&1&&(i(0,"span",85),l(1),n()),s&2){let e=d().$implicit,r=d(2);o(),g(" (",r.getNatureName(e),") ")}}function Le(s,t){if(s&1){let e=b();i(0,"div",113)(1,"input",114),_("change",function(){let a=p(e).$implicit,c=d(2);return S(c.toggleSousNatureSelection(a.idSousNature))}),n(),i(2,"label",115)(3,"strong"),l(4),n(),f(5,Pe,2,1,"span",116),n()()}if(s&2){let e=t.$implicit,r=d(2);o(),u("id","sousNature_"+e.idSousNature)("checked",r.isSousNatureSelected(e.idSousNature))("disabled",r.isEditMode),o(),u("for","sousNature_"+e.idSousNature),o(2),v(e.nomSousNature),o(),u("ngIf",r.getNatureName(e))}}function Ve(s,t){if(s&1){let e=b();i(0,"div",71)(1,"div",72)(2,"div",73)(3,"div",74)(4,"h5",75),m(5,"i",22),l(6),n(),i(7,"button",76),_("click",function(){p(e);let a=d();return S(a.closeLinkModal())}),i(8,"span",77),l(9,"\xD7"),n()()(),i(10,"div",78),f(11,Ne,3,1,"div",18),i(12,"form")(13,"div",79)(14,"label",80)(15,"strong"),l(16,"Sc\xE9nario *"),n()(),i(17,"div",9)(18,"input",81),N("ngModelChange",function(a){p(e);let c=d();return C(c.scenarioSearchTerm,a)||(c.scenarioSearchTerm=a),S(a)}),_("keyup",function(){p(e);let a=d();return S(a.searchScenariosInModal())})("focus",function(){p(e);let a=d();return S(a.showScenarioTable=a.scenarioSearchTerm.length>0)}),n(),i(19,"div",11)(20,"button",12),_("click",function(){p(e);let a=d();return S(a.searchScenariosInModal())}),m(21,"i",13),l(22," Rec "),n()()(),f(23,we,15,1,"div",82)(24,Ie,3,0,"div",83)(25,Te,3,0,"small",84),n(),i(26,"div",79)(27,"label")(28,"strong"),l(29,"Sous-Natures *"),n(),i(30,"small",85),l(31),n()(),i(32,"div",86)(33,"input",87),N("ngModelChange",function(a){p(e);let c=d();return C(c.sousNatureSearchTerm,a)||(c.sousNatureSearchTerm=a),S(a)}),_("keyup",function(){p(e);let a=d();return S(a.filterSousNatures())}),n(),i(34,"div",11)(35,"button",12),_("click",function(){p(e);let a=d();return S(a.filterSousNatures())}),m(36,"i",13),n()()(),i(37,"div",88)(38,"button",89),_("click",function(){p(e);let a=d();return S(a.selectAllSousNatures())}),m(39,"i",90),l(40," Tout s\xE9lectionner "),n(),i(41,"button",91),_("click",function(){p(e);let a=d();return S(a.deselectAllSousNatures())}),m(42,"i",92),l(43," Tout d\xE9s\xE9lectionner "),n()(),i(44,"div",93),f(45,Me,3,1,"div",94)(46,Le,6,6,"div",95),n(),i(47,"small",96),l(48," S\xE9lectionnez une ou plusieurs sous-natures \xE0 associer au sc\xE9nario "),n()()()(),i(49,"div",97)(50,"button",98),_("click",function(){p(e);let a=d();return S(a.closeLinkModal())}),m(51,"i",92),l(52," Annuler "),n(),i(53,"button",25),_("click",function(){p(e);let a=d();return S(a.saveLink())}),m(54,"i",99),l(55),n()()()()()}if(s&2){let e=d();o(6),g(" ",e.isEditMode?"Modifier le lien":"Nouveau lien Sc\xE9nario - Sous-Nature"," "),o(5),u("ngIf",e.modalError),o(7),E("ngModel",e.scenarioSearchTerm),u("disabled",e.isEditMode),o(5),u("ngIf",e.showScenarioTable&&e.filteredScenarios.length>0),o(),u("ngIf",e.showScenarioTable&&e.filteredScenarios.length===0),o(),u("ngIf",e.modalForm.scenarioId),o(6),g(" (",e.modalForm.selectedSousNatureIds.length," s\xE9lectionn\xE9e(s)) "),o(2),E("ngModel",e.sousNatureSearchTerm),o(5),u("disabled",e.filteredSousNatures.length===0),o(3),u("disabled",e.filteredSousNatures.length===0),o(4),u("ngIf",e.filteredSousNatures.length===0),o(),u("ngForOf",e.filteredSousNatures),o(4),u("disabled",e.modalLoading),o(3),u("disabled",e.modalLoading||!e.modalForm.scenarioId||e.modalForm.selectedSousNatureIds.length===0),o(2),g(" ",e.modalLoading?"Enregistrement...":"Enregistrer ("+e.modalForm.selectedSousNatureIds.length+")"," ")}}function Oe(s,t){s&1&&m(0,"div",117)}var re=class s{constructor(t,e,r,a){this.scenariosService=t;this.scenarioSousNatureService=e;this.naturesService=r;this.sousNaturesService=a;this.categorieMap=this.typeCategorieList.reduce((c,h)=>(c[h.key]=h.label,c),{})}scenarios=[];loading=!1;error=null;currentPage=1;pageSize=10;totalPages=1;total=0;actifOnly=!1;searchTerm="";showLinksSection=!1;linksLoading=!1;linksError=null;linksPageIndex=1;linksPageSize=10;linksTotal=0;linksTotalPages=1;selectedScenarioId=null;scenarioSousNatureElements=[];natures=[];sousNatures=[];typeCategorieList=Object.entries(Y).map(([t,e])=>({key:t,label:e}));categorieMap={};showLinkModal=!1;isEditMode=!1;currentLinkElement=null;modalForm={scenarioId:null,selectedSousNatureIds:[]};scenarioSearchTerm="";filteredScenarios=[];allScenariosForSearch=[];showScenarioTable=!1;sousNatureSearchTerm="";filteredSousNatures=[];modalError=null;modalLoading=!1;ngOnInit(){this.loadScenarios()}loadScenarios(){this.loading=!0,this.error=null,this.scenariosService.listScenarios(this.currentPage,this.pageSize,this.actifOnly).subscribe({next:t=>{t&&t.success&&t.data?(this.scenarios=t.data.scenarios.map(e=>y.fromResponse(e)),this.total=t.data.total,this.totalPages=t.data.total_pages,this.currentPage=t.data.page):(this.error=t?.message||"Erreur lors du chargement des sc\xE9narios",this.scenarios=[]),this.loading=!1},error:t=>{this.error="Erreur lors du chargement des sc\xE9narios",this.loading=!1,console.error("Erreur:",t)}})}deleteScenario(t){confirm(`\xCAtes-vous s\xFBr de vouloir supprimer le sc\xE9nario "${t.nom_scenario}" ?`)&&this.scenariosService.deleteScenario(t.id_scenario).subscribe({next:e=>{e&&e.success?this.loadScenarios():alert(e?.message||"Erreur lors de la suppression")},error:e=>{console.error("Erreur lors de la suppression:",e),alert("Erreur lors de la suppression du sc\xE9nario")}})}toggleScenarioStatus(t){let e=!t.actif;this.scenariosService.toggleScenario(t.id_scenario,e).subscribe({next:r=>{if(r){let a=this.scenarios.findIndex(c=>c.id_scenario===t.id_scenario);a!==-1&&(this.scenarios[a]=r)}},error:r=>{console.error("Erreur lors de la mise \xE0 jour:",r),alert("Erreur lors de la mise \xE0 jour du statut")}})}editScenario(t){this.scenariosService.setScenarioToEdit(t)}searchScenarios(){if(this.searchTerm.trim().length===0){this.loadScenarios();return}this.loading=!0,this.error=null,this.scenariosService.searchScenarios(this.searchTerm).subscribe({next:t=>{t&&t.success&&t.data?(this.scenarios=t.data.map(e=>y.fromResponse(e)),this.total=this.scenarios.length,this.totalPages=1):(this.error=t?.message||"Aucun sc\xE9nario trouv\xE9",this.scenarios=[]),this.loading=!1},error:t=>{this.error="Erreur lors de la recherche",this.loading=!1,console.error("Erreur:",t)}})}toggleActifOnly(){this.actifOnly=!this.actifOnly,this.currentPage=1,this.loadScenarios()}goToPage(t){t>=1&&t<=this.totalPages&&(this.currentPage=t,this.loadScenarios())}previousPage(){this.currentPage>1&&(this.currentPage--,this.loadScenarios())}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadScenarios())}toggleLinksSection(){this.showLinksSection=!this.showLinksSection,this.showLinksSection&&this.scenarioSousNatureElements.length===0&&this.loadLinksData()}loadLinksData(){this.linksLoading=!0,this.linksError=null,I({sousNatures:this.sousNaturesService.listSousNatures(1,1e3),natures:this.naturesService.listNatures(1,1e3),scenarioSousNatures:this.scenarioSousNatureService.listScenarioSousNatures(this.linksPageIndex,this.linksPageSize,this.selectedScenarioId||void 0)}).subscribe({next:({sousNatures:t,natures:e,scenarioSousNatures:r})=>{r&&r.success&&r.data?(this.sousNatures=t.data.sous_natures,this.natures=e.data.base_natures,this.buildLinksElements(r.data.scenario_sous_natures.map(a=>te.fromResponse(a))),this.linksTotal=r.data.total,this.linksTotalPages=r.data.total_pages):(this.linksError=r?.message||"Erreur lors du chargement des liens",this.scenarioSousNatureElements=[]),this.linksLoading=!1},error:t=>{this.linksError="Erreur lors du chargement des donn\xE9es",this.linksLoading=!1,console.error("Erreur:",t)}})}buildLinksElements(t){this.scenarioSousNatureElements=t.map(e=>{let r=this.sousNatures.find(h=>h.idSousNature===e.id_sous_nature),a=r?this.natures.find(h=>h.idNature===r.idNature):void 0;return{scenario:this.scenarios.find(h=>h.id_scenario===e.id_scenario)??{},sousNature:r??{},nature:a??{},scenarioSousNature:e}})}onLinksPageChange(t){t<1||t>this.linksTotalPages||(this.linksPageIndex=t,this.loadLinksData())}filterLinksByScenario(t){this.selectedScenarioId=t,this.linksPageIndex=1,this.loadLinksData()}addScenarioSousNatureLink(){this.isEditMode=!1,this.currentLinkElement=null,this.modalForm={scenarioId:null,selectedSousNatureIds:[]},this.scenarioSearchTerm="",this.filteredScenarios=[],this.showScenarioTable=!1,this.sousNatureSearchTerm="",this.filteredSousNatures=[],this.modalError=null,this.showLinkModal=!0,this.loadAllScenarios(),this.sousNatures.length===0?this.sousNaturesService.listSousNatures(1,1e3).subscribe({next:t=>{t&&t.success&&t.data&&(this.sousNatures=t.data.sous_natures,this.filterSousNatures())},error:t=>{console.error("Erreur lors du chargement des sous-natures:",t),this.filterSousNatures()}}):this.filterSousNatures()}updateScenarioSousNatureLink(t){this.isEditMode=!1,this.addScenarioSousNatureLink()}closeLinkModal(){this.showLinkModal=!1,this.isEditMode=!1,this.currentLinkElement=null,this.modalForm={scenarioId:null,selectedSousNatureIds:[]},this.scenarioSearchTerm="",this.filteredScenarios=[],this.showScenarioTable=!1,this.sousNatureSearchTerm="",this.filteredSousNatures=[],this.modalError=null}filterSousNatures(){if(this.sousNatureSearchTerm.trim().length===0){this.filteredSousNatures=[...this.sousNatures];return}let t=this.sousNatureSearchTerm.toLowerCase();this.filteredSousNatures=this.sousNatures.filter(e=>e.nomSousNature.toLowerCase().includes(t)||this.getNatureName(e).toLowerCase().includes(t)||e.idSousNature.toString().includes(t))}selectAllSousNatures(){this.filteredSousNatures.forEach(t=>{this.modalForm.selectedSousNatureIds.includes(t.idSousNature)||this.modalForm.selectedSousNatureIds.push(t.idSousNature)})}deselectAllSousNatures(){this.filteredSousNatures.forEach(t=>{let e=this.modalForm.selectedSousNatureIds.indexOf(t.idSousNature);e>-1&&this.modalForm.selectedSousNatureIds.splice(e,1)})}loadAllScenarios(){this.scenariosService.listScenarios(1,1e3,!1).subscribe({next:t=>{t&&t.success&&t.data&&(this.allScenariosForSearch=t.data.scenarios.map(e=>y.fromResponse(e)))},error:t=>{console.error("Erreur lors du chargement des sc\xE9narios:",t)}})}searchScenariosInModal(){if(this.scenarioSearchTerm.trim().length===0){this.filteredScenarios=[],this.showScenarioTable=!1;return}this.showScenarioTable=!0;let t=this.scenarioSearchTerm.toLowerCase();this.filteredScenarios=this.allScenariosForSearch.filter(e=>e.nom_scenario.toLowerCase().includes(t)||e.id_scenario.toString().includes(t))}selectScenario(t){this.modalForm.scenarioId=t.id_scenario,this.scenarioSearchTerm=t.nom_scenario,this.showScenarioTable=!1}toggleSousNatureSelection(t){let e=this.modalForm.selectedSousNatureIds.indexOf(t);e>-1?this.modalForm.selectedSousNatureIds.splice(e,1):this.modalForm.selectedSousNatureIds.push(t)}isSousNatureSelected(t){return this.modalForm.selectedSousNatureIds.includes(t)}saveLink(){if(this.modalError=null,!this.modalForm.scenarioId){this.modalError="Veuillez s\xE9lectionner un sc\xE9nario";return}if(this.modalForm.selectedSousNatureIds.length===0){this.modalError="Veuillez s\xE9lectionner au moins une sous-nature";return}this.modalLoading=!0;let t=this.modalForm.selectedSousNatureIds.map(e=>{let r={id_scenario:this.modalForm.scenarioId,id_sous_nature:e};return this.scenarioSousNatureService.createScenarioSousNature(r)});I(t).subscribe({next:e=>{let r=e.filter(a=>a!==null).length;r===this.modalForm.selectedSousNatureIds.length?(this.loadLinksData(),this.closeLinkModal()):(this.modalError=`${r} sur ${this.modalForm.selectedSousNatureIds.length} lien(s) cr\xE9\xE9(s) avec succ\xE8s`,this.loadLinksData()),this.modalLoading=!1},error:e=>{console.error("Erreur lors de la cr\xE9ation des liens:",e),this.createLinksSequentially()}})}createLinksSequentially(){let t=0,e=0,r=[],a=0,c=()=>{if(a>=this.modalForm.selectedSousNatureIds.length){t>0&&this.loadLinksData(),e>0?this.modalError=`${t} lien(s) cr\xE9\xE9(s), ${e} erreur(s). ${r.join("; ")}`:this.closeLinkModal(),this.modalLoading=!1;return}let h=this.modalForm.selectedSousNatureIds[a],ae={id_scenario:this.modalForm.scenarioId,id_sous_nature:h};this.scenarioSousNatureService.createScenarioSousNature(ae).subscribe({next:w=>{w?t++:(e++,r.push(`Sous-nature ${h}`)),a++,c()},error:w=>{e++;let se=w.error?.message||"Erreur inconnue";r.push(`Sous-nature ${h}: ${se}`),a++,c()}})};c()}refreshLinks(){this.loadLinksData()}getNatureName(t){if(!t)return"";let e=this.natures.find(r=>r.idNature===t.idNature);return e?e.nomNature:""}deleteScenarioSousNatureLink(t){confirm(`\xCAtes-vous s\xFBr de vouloir supprimer le lien entre "${t.scenario.nom_scenario}" et "${t.sousNature.nomSousNature}" ?`)&&this.scenarioSousNatureService.deleteScenarioSousNature(t.scenarioSousNature.id_scenario_sous_nature).subscribe({next:e=>{e&&e.success?this.loadLinksData():alert(e?.message||"Erreur lors de la suppression")},error:e=>{console.error("Erreur lors de la suppression:",e),alert("Erreur lors de la suppression du lien")}})}static \u0275fac=function(e){return new(e||s)(k(ie),k(ne),k(Z),k(ee))};static \u0275cmp=P({type:s,selectors:[["app-scenarios"]],decls:46,vars:15,consts:[[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-tools"],["type","button","routerLink","/scenarios/create",1,"btn","btn-primary"],[1,"fas","fa-plus"],[1,"card-body"],[1,"row","mb-3"],[1,"col-md-6"],[1,"input-group"],["type","text","placeholder","Rechercher un sc\xE9nario...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],[1,"input-group-append"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-search"],[1,"col-md-6","text-right"],[1,"form-check","form-check-inline"],["type","checkbox","id","actifOnly",1,"form-check-input",3,"ngModelChange","change","ngModel"],["for","actifOnly",1,"form-check-label"],["class","alert alert-danger",4,"ngIf"],["class","text-center",4,"ngIf"],[4,"ngIf"],[1,"card","mt-4"],[1,"fas","fa-link","mr-2"],["type","button",1,"btn","btn-sm","btn-secondary","mr-2",3,"click"],[1,"fas"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["type","button","title","Recharger",1,"btn","btn-info","ml-2",3,"click","disabled"],[1,"fas","fa-sync-alt"],["class","card-body",4,"ngIf"],["class","modal fade show","style","display: block;","tabindex","-1","role","dialog",4,"ngIf"],["class","modal-backdrop fade show",4,"ngIf"],[1,"alert","alert-danger"],[1,"fas","fa-exclamation-triangle"],[1,"text-center"],[1,"fas","fa-spinner","fa-spin","fa-2x"],[1,"table","table-bordered","table-striped"],[4,"ngFor","ngForOf"],["class","text-center py-4",4,"ngIf"],["class","d-flex justify-content-between align-items-center mt-3",4,"ngIf"],[1,"badge","badge-info"],[1,"badge"],["role","group",1,"btn-group"],["title","Modifier",1,"btn","btn-sm","btn-info",3,"click","routerLink"],[1,"fas","fa-edit"],[1,"btn","btn-sm",3,"click","title"],["title","Supprimer",1,"btn","btn-sm","btn-danger",3,"click"],[1,"fas","fa-trash"],[1,"text-center","py-4"],[1,"fas","fa-chart-line","fa-3x","text-muted","mb-3"],[1,"text-muted"],[1,"d-flex","justify-content-between","align-items-center","mt-3"],[1,"text-muted","mb-0"],[1,"pagination","mb-0"],[1,"page-item"],["href","#",1,"page-link",3,"click"],[1,"fas","fa-chevron-left"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"fas","fa-chevron-right"],["for","scenarioFilter"],["id","scenarioFilter",1,"form-control",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"table","table-bordered","table-hover"],[1,"thead-dark"],["class","card-footer clearfix",4,"ngIf"],[1,"fas","fa-link","fa-3x","text-muted","mb-3"],[1,"card-footer","clearfix"],[1,"pagination","pagination-sm","m-0","float-end"],["href","#","aria-label","Pr\xE9c\xE9dent",1,"page-link",3,"click"],["href","#","aria-label","Suivant",1,"page-link",3,"click"],[1,"float-start","mt-2"],["tabindex","-1","role","dialog",1,"modal","fade","show",2,"display","block"],["role","document",1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"form-group"],["for","scenarioSearch"],["type","text","id","scenarioSearch","placeholder","Rechercher un sc\xE9nario...","name","scenarioSearch",1,"form-control",3,"ngModelChange","keyup","focus","ngModel","disabled"],["class","mt-2",4,"ngIf"],["class","mt-2 text-muted",4,"ngIf"],["class","form-text text-success",4,"ngIf"],[1,"text-muted","ml-2"],[1,"input-group","mb-2"],["type","text","placeholder","Rechercher une sous-nature...","name","sousNatureSearch",1,"form-control",3,"ngModelChange","keyup","ngModel"],[1,"mb-2"],["type","button",1,"btn","btn-sm","btn-outline-primary","mr-1",3,"click","disabled"],[1,"fas","fa-check-double"],["type","button",1,"btn","btn-sm","btn-outline-secondary",3,"click","disabled"],[1,"fas","fa-times"],[1,"border","rounded","p-2",2,"max-height","300px","overflow-y","auto"],["class","text-muted text-center py-3",4,"ngIf"],["class","form-check mb-2",4,"ngFor","ngForOf"],[1,"form-text","text-muted"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],[1,"fas","fa-save"],[1,"mt-2"],[1,"table-responsive",2,"max-height","200px","overflow-y","auto"],[1,"table","table-sm","table-bordered","table-hover"],[1,"thead-light"],["style","cursor: pointer;",4,"ngFor","ngForOf"],[2,"cursor","pointer"],["type","button",1,"btn","btn-sm","btn-primary",3,"click"],[1,"fas","fa-check"],[1,"mt-2","text-muted"],[1,"form-text","text-success"],[1,"fas","fa-check-circle"],[1,"text-muted","text-center","py-3"],[1,"fas","fa-info-circle"],[1,"form-check","mb-2"],["type","checkbox",1,"form-check-input",3,"change","id","checked","disabled"],[1,"form-check-label",2,"cursor","pointer","width","100%",3,"for"],["class","text-muted ml-2",4,"ngIf"],[1,"modal-backdrop","fade","show"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"h3",2),l(3,"Gestion des sc\xE9narios"),n(),i(4,"div",3)(5,"button",4),m(6,"i",5),l(7," Ajouter un sc\xE9nario "),n()()(),i(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9)(12,"input",10),N("ngModelChange",function(c){return C(r.searchTerm,c)||(r.searchTerm=c),c}),_("keyup.enter",function(){return r.searchScenarios()}),n(),i(13,"div",11)(14,"button",12),_("click",function(){return r.searchScenarios()}),m(15,"i",13),n()()()(),i(16,"div",14)(17,"div",15)(18,"input",16),N("ngModelChange",function(c){return C(r.actifOnly,c)||(r.actifOnly=c),c}),_("change",function(){return r.toggleActifOnly()}),n(),i(19,"label",17),l(20," Afficher uniquement les sc\xE9narios actifs "),n()()()(),f(21,ce,3,1,"div",18)(22,de,4,0,"div",19)(23,Se,24,3,"div",20),n()(),i(24,"div",21)(25,"div",1)(26,"h2",2),m(27,"i",22),i(28,"b"),l(29,"Sc\xE9nario"),n(),l(30," - "),i(31,"i"),l(32,"Liens avec Sous-Natures"),n()(),i(33,"div",3)(34,"button",23),_("click",function(){return r.toggleLinksSection()}),m(35,"i",24),l(36),n(),i(37,"button",25),_("click",function(){return r.addScenarioSousNatureLink()}),m(38,"i",5),l(39," Nouveau Lien "),n(),i(40,"button",26),_("click",function(){return r.refreshLinks()}),m(41,"i",27),l(42," Rec "),n()()(),f(43,Ce,12,6,"div",28),n(),f(44,Ve,56,16,"div",29)(45,Oe,1,0,"div",30)),e&2&&(o(12),E("ngModel",r.searchTerm),o(6),E("ngModel",r.actifOnly),o(3),u("ngIf",r.error),o(),u("ngIf",r.loading),o(),u("ngIf",!r.loading&&!r.error),o(12),x("fa-chevron-down",!r.showLinksSection)("fa-chevron-up",r.showLinksSection),o(),g(" ",r.showLinksSection?"Masquer":"Afficher"," "),o(),u("disabled",!r.showLinksSection),o(3),u("disabled",!r.showLinksSection||r.linksLoading),o(3),u("ngIf",r.showLinksSection),o(),u("ngIf",r.showLinkModal),o(),u("ngIf",r.showLinkModal))},dependencies:[$,F,A,j,R,X,U,K,Q,z,W,H,B,q,J,G,D],styles:[".table-responsive[_ngcontent-%COMP%]{border-radius:8px;overflow:hidden;box-shadow:0 4px 12px #1111111a}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#5d83a9;color:#fff;text-align:center}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.table-row-hover[_ngcontent-%COMP%]:hover{background-color:#f1f3f5;transition:background .25s ease}.modal.show[_ngcontent-%COMP%]{display:block!important}.modal-backdrop.show[_ngcontent-%COMP%]{opacity:.5}.modal-dialog[_ngcontent-%COMP%]{z-index:1050}.modal-content[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 4px 6px #0000001a}.modal-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid #dee2e6;border-radius:8px 8px 0 0}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-footer[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1rem 1.5rem}.table-responsive[_ngcontent-%COMP%]{border:1px solid #dee2e6;border-radius:4px}.table-sm[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#f8f9fa;z-index:10}.table-hover[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:.25rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.form-control[_ngcontent-%COMP%]:focus{border-color:#80bdff;box-shadow:0 0 0 .2rem #007bff40}.modal-loading[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.badge[_ngcontent-%COMP%]{display:inline-block;padding:6px 12px;font-size:.8rem;border-radius:999px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:#fff!important}.badge-success[_ngcontent-%COMP%]{background-color:#28a745!important}.badge-danger[_ngcontent-%COMP%]{background-color:#dc3545!important}.badge-warning[_ngcontent-%COMP%]{background-color:#ffc107!important;color:#212529!important}.badge[_ngcontent-%COMP%]:hover{opacity:.9;cursor:default}.badge-info[_ngcontent-%COMP%]{background-color:#17a2b8!important;padding:6px 12px;font-size:.85rem;border-radius:12px;font-weight:600}"]})};export{re as ScenariosComponent};
