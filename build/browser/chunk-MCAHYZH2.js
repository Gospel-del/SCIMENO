import{a as j}from"./chunk-SE2LHW5U.js";import{a as z,b as L}from"./chunk-MNJUUXAV.js";import"./chunk-SGGM3K3A.js";import{w as D}from"./chunk-LTEV2KH7.js";import{i as F,j as V,l as N,m as U,n as R,o as A}from"./chunk-NKZL4UVF.js";import{Fb as h,Hb as f,Ib as c,Oa as o,Pc as y,Qc as T,Rc as w,Ub as b,Wb as r,Xb as _,Xc as k,Yb as v,Yc as O,Za as C,_b as S,db as E,ha as p,hc as I,ia as g,ib as x,kc as P,mc as M,vb as d,wb as n,xb as i,yb as u}from"./chunk-S4NM23YD.js";import"./chunk-CSTXWUWE.js";var H=()=>[];function q(a,t){if(a&1){let e=h();n(0,"div",15),r(1),n(2,"button",16),f("click",function(){let l=p(e).$implicit,m=c();return g(m.closeToast(l))}),r(3,"\xD7"),i()()}if(a&2){let e=t.$implicit;b("show",e.visible),d("ngClass",e.type),o(),v(" ",e.message," ")}}function B(a,t){if(a&1&&(n(0,"div",17),u(1,"i",18),r(2),i()),a&2){let e=c();o(2),v(" ",e.error," ")}}function G(a,t){a&1&&u(0,"mat-progress-spinner",19)}function J(a,t){if(a&1){let e=h();n(0,"tr")(1,"td"),r(2),i(),n(3,"td"),r(4),i(),n(5,"td"),r(6),i(),n(7,"td"),r(8),i(),n(9,"td"),r(10),i(),n(11,"td")(12,"span",23)(13,"i",24),r(14),i(),r(15),i()(),n(16,"td"),r(17),P(18,"date"),i(),n(19,"td")(20,"div",25)(21,"button",26),f("click",function(){let l=p(e).$implicit,m=c(2);return g(m.updateUser(l))}),u(22,"i",27),i(),n(23,"button",28),f("click",function(){let l=p(e).$implicit,m=c(2);return g(m.deleteUser(l))}),u(24,"i",29),i()()()()}if(a&2){let e=t.$implicit,s=c(2);o(2),_(e.idUtilisateur),o(2),_(e.getFullName()),o(2),_(e.email),o(2),_(s.fonctionMap[e.fonction||""]),o(2),_(e.telephone||"Non renseign\xE9"),o(2),d("ngClass",e.isActive()?"badge-actif":"badge-inactif"),o(2),v(" ",e.isActive()?"\u2714":"\u2716"," "),o(),v(" ",e.isActive()?"ACTIF":"INACTIF"," "),o(2),_(M(18,9,e.created_at,"dd/MM/yyyy"))}}function K(a,t){if(a&1){let e=h();n(0,"li",33)(1,"a",34),f("click",function(l){let m=p(e).index;return c(3).goToPage(m+1),g(l.preventDefault())}),r(2),i()()}if(a&2){let e=t.index,s=c(3);b("active",s.pageIndex===e+1),o(2),v(" ",e+1," ")}}function Q(a,t){if(a&1){let e=h();n(0,"div",30)(1,"div")(2,"p",31),r(3),i()(),n(4,"nav")(5,"ul",32)(6,"li",33)(7,"a",34),f("click",function(l){return p(e),c(2).previousPage(),g(l.preventDefault())}),u(8,"i",35),i()(),x(9,K,3,3,"li",36),n(10,"li",33)(11,"a",34),f("click",function(l){return p(e),c(2).nextPage(),g(l.preventDefault())}),u(12,"i",37),i()()()()()}if(a&2){let e=c(2);o(3),S(" Page ",e.pageIndex," sur ",e.totalPages," (",e.total," nature(s) au total) "),o(3),b("disabled",e.pageIndex===1),o(3),d("ngForOf",I(8,H).constructor(e.totalPages)),o(),b("disabled",e.pageIndex===e.totalPages)}}function W(a,t){if(a&1&&(n(0,"div")(1,"table",20)(2,"thead")(3,"tr")(4,"th"),r(5,"ID"),i(),n(6,"th"),r(7,"Nom complet"),i(),n(8,"th"),r(9,"Email"),i(),n(10,"th"),r(11,"Fonction"),i(),n(12,"th"),r(13,"T\xE9l\xE9phone"),i(),n(14,"th"),r(15,"Statut"),i(),n(16,"th"),r(17,"Cr\xE9\xE9 le"),i(),n(18,"th"),r(19,"Actions"),i()()(),n(20,"tbody"),x(21,J,25,12,"tr",21),i()(),x(22,Q,13,9,"div",22),i()),a&2){let e=c();o(21),d("ngForOf",e.users),o(),d("ngIf",e.totalPages>1)}}var $=class a{constructor(t,e){this.userService=t;this.router=e}users=[];loading=!1;error=null;pageIndex=1;pageSize=10;totalPages=1;total=0;Math=Math;searchTerm="";toasts=[];fonctionMap={};fonctionUserList=Object.values(R).map(t=>({key:t,label:A[t]}));showToast(t,e="success"){let s={message:t,type:e,visible:!1};this.toasts.push(s),requestAnimationFrame(()=>{s.visible=!0}),s.timeout=setTimeout(()=>this.closeToast(s),3e3)}closeToast(t){clearTimeout(t.timeout),t.visible=!1,setTimeout(()=>{this.toasts=this.toasts.filter(e=>e!==t)},400)}ngOnInit(){this.fonctionMap=this.fonctionUserList.reduce((t,e)=>(t[e.key]=e.label,t),{}),this.loadUsers()}loadUsers(){this.loading=!0,this.error=null,this.userService.getAllUsers(this.pageIndex,this.pageSize).subscribe({next:t=>{console.log("response = ",t),t&&t.success&&t.data?(this.users=t.data.utilisateurs.map(e=>U.fromResponse(e)),this.total=t.data.total,this.totalPages=t.data.total_pages,this.pageIndex=t.data.page):(this.error=t?.message||"Erreur lors du chargement des utilisateurs",this.users=[]),this.loading=!1},error:t=>{this.error="Erreur lors du chargement des utilisateurs",this.loading=!1,console.error("Erreur:",t)}})}goToPage(t){t>=1&&t<=this.totalPages&&(this.pageIndex=t,this.loadUsers())}previousPage(){this.pageIndex>1&&(this.pageIndex--,this.loadUsers())}nextPage(){this.pageIndex<this.totalPages&&(this.pageIndex++,this.loadUsers())}deleteUser(t){confirm(`\xCAtes-vous s\xFBr de vouloir supprimer l'utilisateur ${t.getFullName()} ?`)&&this.userService.deleteUser(t.idUtilisateur).subscribe({next:()=>{this.showToast(["Suppression r\xE9ussie !"],"success"),this.loadUsers()},error:e=>{let s=[];s.push(e.error?.message||"Erreur inconnue."),this.showToast(s,"error")}})}search(){if(this.searchTerm.trim().length===0){this.loadUsers();return}this.loading=!0,this.error=null,this.userService.searchUsers(this.searchTerm).subscribe({next:t=>{t&&t.success&&t.data?(this.users=t.data.map(e=>U.fromResponse(e)),this.total=this.users.length,this.totalPages=1):(this.error=t?.message||"Aucun utilisateur trouv\xE9e",this.users=[]),this.loading=!1},error:t=>{this.error="Erreur lors de la recherche",this.loading=!1,console.error("Erreur:",t)}})}toggleUserStatus(t){t.statut=!t.statut,this.userService.updateUser(t).subscribe({next:e=>{let s=this.users.findIndex(l=>l.idUtilisateur===t.idUtilisateur);s!==-1&&(this.users[s]=e)},error:e=>{this.showToast(["Erreur lors de la mise \xE0 jour"],"error"),console.error("Erreur lors de la mise \xE0 jour:",e)}})}updateUser(t){this.userService.setUserToEdit(t),this.router.navigate(["users/edit"])}static \u0275fac=function(e){return new(e||a)(C(j),C(F))};static \u0275cmp=E({type:a,selectors:[["app-users"]],decls:22,vars:4,consts:[[1,"toast-container"],["class","toast",3,"ngClass","show",4,"ngFor","ngForOf"],[1,"row"],[1,"col-12"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-tools"],["type","button","routerLink","/users/create",1,"btn","btn-primary"],[1,"fas","fa-plus"],[1,"card-body"],[1,"row","mb-3"],["class","alert alert-danger",4,"ngIf"],["mode","indeterminate","diameter","50","style","display: block; margin: 0 auto;",4,"ngIf"],[4,"ngIf"],[1,"toast",3,"ngClass"],[1,"close-btn",3,"click"],[1,"alert","alert-danger"],[1,"fas","fa-exclamation-triangle"],["mode","indeterminate","diameter","50",2,"display","block","margin","0 auto"],[1,"table","table-bordered","table-hover"],[4,"ngFor","ngForOf"],["class","d-flex justify-content-between align-items-center mt-3",4,"ngIf"],[1,"badge","statut-badge",3,"ngClass"],[1,"status-icon"],["role","group",1,"btn-group"],["title","Modidier",1,"btn","btn-sm","btn-info",3,"click"],[1,"fas","fa-edit"],["title","Supprimer",1,"btn","btn-sm","btn-danger",3,"click"],[1,"fas","fa-trash"],[1,"d-flex","justify-content-between","align-items-center","mt-3"],[1,"text-muted","mb-0"],[1,"pagination","mb-0"],[1,"page-item"],["href","#",1,"page-link",3,"click"],[1,"fas","fa-chevron-left"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"fas","fa-chevron-right"]],template:function(e,s){e&1&&(n(0,"div",0),x(1,q,4,4,"div",1),i(),n(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h3",6)(7,"b"),r(8," utilisateur "),i(),r(9," - "),n(10,"i"),r(11,"Listing"),i(),r(12," -"),i(),n(13,"div",7)(14,"button",8),u(15,"i",9),r(16," Nouvel utilisateur "),i()()(),n(17,"div",10),u(18,"div",11),x(19,B,3,1,"div",12)(20,G,1,0,"mat-progress-spinner",13)(21,W,23,2,"div",14),i()()()()),e&2&&(o(),d("ngForOf",s.toasts),o(18),d("ngIf",s.error),o(),d("ngIf",s.loading),o(),d("ngIf",!s.loading&&!s.error))},dependencies:[O,y,T,w,D,N,V,L,z,k],styles:[".table-responsive[_ngcontent-%COMP%]{border-radius:8px;overflow:hidden;box-shadow:0 4px 12px #1111111a}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#5d83a9;color:#fff;text-align:center}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.table-row-hover[_ngcontent-%COMP%]:hover{background-color:#f1f3f5;transition:background .25s ease}.toast-container[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;display:flex;flex-direction:column;gap:10px;z-index:9999}.toast[_ngcontent-%COMP%]{min-width:220px;padding:12px 16px;border-radius:6px;color:#fff;box-shadow:0 4px 12px #00000040;font-size:14px;display:flex;justify-content:space-between;align-items:center;opacity:0;transform:translate(100%);transition:transform .4s ease,opacity .4s ease}.toast.show[_ngcontent-%COMP%]{opacity:1;transform:translate(0)}.toast.success[_ngcontent-%COMP%]{background-color:#4caf50}.toast.error[_ngcontent-%COMP%]{background-color:#f44336}.toast[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;font-size:16px;line-height:1;cursor:pointer}.badge.statut-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:.25em .6em;font-size:.85em;font-weight:600;border-radius:.25rem}.badge-actif[_ngcontent-%COMP%]{background-color:#28a745;color:#fff}.badge-inactif[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}.status-icon[_ngcontent-%COMP%]{display:inline-block;margin-right:.4em;font-size:.9em}"]})};export{$ as UsersComponent};
