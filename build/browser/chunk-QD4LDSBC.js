import{a as $,b as y,c as H}from"./chunk-VMKVCHVW.js";import{a as W}from"./chunk-IJB3HI4L.js";import{a as j,b as z}from"./chunk-MNJUUXAV.js";import{c as A}from"./chunk-Y2GQIFGB.js";import"./chunk-6C43PQNK.js";import"./chunk-SGGM3K3A.js";import{b as D,e as F,i as L,w as R}from"./chunk-LTEV2KH7.js";import{i as V}from"./chunk-NKZL4UVF.js";import{$b as T,Fb as h,Hb as m,Ib as u,Oa as s,Pc as w,Qc as M,Rc as k,Ub as x,Wb as o,Xb as b,Yb as N,Yc as O,Za as v,_b as S,ac as I,bc as E,db as C,ha as g,hc as P,ia as f,ib as _,vb as d,wb as n,xb as r,yb as p}from"./chunk-S4NM23YD.js";import"./chunk-CSTXWUWE.js";var B=()=>[];function G(a,t){if(a&1){let e=h();n(0,"div",23),o(1),n(2,"button",24),m("click",function(){let l=g(e).$implicit,c=u();return f(c.closeToast(l))}),o(3,"\xD7"),r()()}if(a&2){let e=t.$implicit;x("show",e.visible),d("ngClass",e.type),s(),N(" ",e.message," ")}}function J(a,t){if(a&1&&(n(0,"div",25),p(1,"i",26),o(2),r()),a&2){let e=u();s(2),N(" ",e.error," ")}}function K(a,t){a&1&&(n(0,"mat-progress-spinner",27)(1,"p"),o(2,"Chargement des natures..."),r()())}function Q(a,t){if(a&1){let e=h();n(0,"button",35),m("click",function(){g(e);let l=u().$implicit,c=u(2);return f(c.supprimerNature(l))}),p(1,"i",36),r()}}function U(a,t){if(a&1){let e=h();n(0,"tr")(1,"td"),o(2),r(),n(3,"td"),o(4),r(),n(5,"td"),o(6),r(),n(7,"td"),o(8),r(),n(9,"td")(10,"div",31)(11,"button",32),m("click",function(){let l=g(e).$implicit,c=u(2);return f(c.updateNature(l))}),p(12,"i",33),r(),_(13,Q,2,0,"button",34),r()()()}if(a&2){let e=t.$implicit,i=u(2);s(2),b(e.idNature),s(2),b(e.nomNature),s(2),b(i.categorieMap[e.typeNature]),s(2),b(e.detailNature),s(5),d("ngIf",e.idNature>0)}}function X(a,t){if(a&1&&(n(0,"table",28)(1,"thead",29)(2,"tr")(3,"th"),o(4,"ID"),r(),n(5,"th"),o(6,"Nom"),r(),n(7,"th"),o(8,"Cat\xE9gorie"),r(),n(9,"th"),o(10,"D\xE9tail"),r(),n(11,"th"),o(12,"Actions"),r()()(),n(13,"tbody"),_(14,U,14,5,"tr",30),r()()),a&2){let e=u();s(14),d("ngForOf",e.natures)}}function Y(a,t){if(a&1){let e=h();n(0,"li",40)(1,"a",41),m("click",function(l){let c=g(e).index;return u(2).goToPage(c+1),f(l.preventDefault())}),o(2),r()()}if(a&2){let e=t.index,i=u(2);x("active",i.pageIndex===e+1),s(2),N(" ",e+1," ")}}function Z(a,t){if(a&1){let e=h();n(0,"div",37)(1,"div")(2,"p",38),o(3),r()(),n(4,"nav")(5,"ul",39)(6,"li",40)(7,"a",41),m("click",function(l){return g(e),u().previousPage(),f(l.preventDefault())}),p(8,"i",42),r()(),_(9,Y,3,3,"li",43),n(10,"li",40)(11,"a",41),m("click",function(l){return g(e),u().nextPage(),f(l.preventDefault())}),p(12,"i",44),r()()()()()}if(a&2){let e=u();s(3),S(" Page ",e.pageIndex," sur ",e.totalPages," (",e.total," nature(s) au total) "),s(3),x("disabled",e.pageIndex===1),s(3),d("ngForOf",P(8,B).constructor(e.totalPages)),s(),x("disabled",e.pageIndex===e.totalPages)}}var q=class a{constructor(t,e,i){this.natureService=t;this.router=e;this.dialog=i}error=null;pageIndex=1;pageSize=10;totalPages=1;total=0;Math=Math;isLoading=!0;natures=[];actifOnly=!1;searchTerm="";typeCategorieList=Object.entries($).map(([t,e])=>({key:t,label:e}));categorieMap={};toasts=[];showToast(t,e="success"){let i={message:t,type:e,visible:!1};this.toasts.push(i),requestAnimationFrame(()=>{i.visible=!0}),i.timeout=setTimeout(()=>this.closeToast(i),3e3)}closeToast(t){clearTimeout(t.timeout),t.visible=!1,setTimeout(()=>{this.toasts=this.toasts.filter(e=>e!==t)},400)}ngOnInit(){this.categorieMap=this.typeCategorieList.reduce((t,e)=>(t[e.key]=e.label,t),{}),console.log("ngOnInit = ",this.categorieMap),this.loadNatures()}loadNatures(){this.isLoading=!0,this.natureService.listNatures(this.pageIndex,this.pageSize,void 0,this.actifOnly).subscribe(t=>{t&&t.success&&t.data?(this.natures=t.data.base_natures.map(e=>y.fromResponse(e)),this.total=t.data.total,this.totalPages=t.data.total_pages,this.pageIndex=t.data.page):(this.error=t?.message||"Erreur lors du chargement des natures",this.natures=[]),this.isLoading=!1},t=>{this.error="Erreur lors du chargement des natures",console.error("Erreur:",t),this.isLoading=!1})}goToPage(t){t>=1&&t<=this.totalPages&&(this.pageIndex=t,this.loadNatures())}previousPage(){this.pageIndex>1&&(this.pageIndex--,this.loadNatures())}nextPage(){this.pageIndex<this.totalPages&&(this.pageIndex++,this.loadNatures())}addNature(){this.router.navigate(["natures/create"])}supprimerNature(t){this.dialog.open(W,{width:"350px",data:{title:"Confirmation",message:"Voulez-vous vraiment supprimer le nature "+t.nomNature+" ?",cancel:"Non",valid:"Oui"}}).afterClosed().subscribe(i=>{i===!0&&this.natureService.deleteNature(t).subscribe(l=>{this.showToast(["Suppression r\xE9ussie !"],"success"),this.loadNatures()},l=>{let c=[];c.push(l.error?.message||"Erreur inconnue."),this.showToast(c,"error")})})}updateNature(t){this.natureService.setNatureToEdit(t),this.router.navigate(["natures/edit"])}search(){if(this.searchTerm.trim().length===0){this.loadNatures();return}this.isLoading=!0,this.error=null,this.natureService.searchNature(this.searchTerm).subscribe({next:t=>{t&&t.success&&t.data?(this.natures=t.data.map(e=>y.fromResponse(e)),this.total=this.natures.length,this.totalPages=1):(this.error=t?.message||"Aucune nature trouv\xE9e",this.natures=[]),this.isLoading=!1},error:t=>{this.error="Erreur lors de la recherche",this.isLoading=!1,console.error("Erreur:",t)}})}toggleActifOnly(){this.actifOnly=!this.actifOnly,this.pageIndex=1,this.loadNatures()}static \u0275fac=function(e){return new(e||a)(v(H),v(V),v(A))};static \u0275cmp=C({type:a,selectors:[["app-natures"]],decls:30,vars:6,consts:[[1,"toast-container"],["class","toast",3,"ngClass","show",4,"ngFor","ngForOf"],[1,"row"],[1,"col-12"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"fas","fa-user-tie","mr-2"],[1,"card-tools"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus"],[1,"card-body"],[1,"row","mb-3"],[1,"col-md-6"],[1,"input-group"],["type","text","placeholder","Rechercher une nature...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],[1,"input-group-append"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-search"],["class","alert alert-danger",4,"ngIf"],["mode","indeterminate","diameter","50","style","display: block; margin: 0 auto;",4,"ngIf"],["class","table table-bordered table-hover",4,"ngIf"],["class","d-flex justify-content-between align-items-center mt-3",4,"ngIf"],[1,"toast",3,"ngClass"],[1,"close-btn",3,"click"],[1,"alert","alert-danger"],[1,"fas","fa-exclamation-triangle"],["mode","indeterminate","diameter","50",2,"display","block","margin","0 auto"],[1,"table","table-bordered","table-hover"],[1,"thead-dark"],[4,"ngFor","ngForOf"],["role","group",1,"btn-group"],[1,"btn","btn-sm","btn-info","mr-1",3,"click"],[1,"fas","fa-edit"],["class","btn btn-sm btn-danger",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"fas","fa-trash"],[1,"d-flex","justify-content-between","align-items-center","mt-3"],[1,"text-muted","mb-0"],[1,"pagination","mb-0"],[1,"page-item"],["href","#",1,"page-link",3,"click"],[1,"fas","fa-chevron-left"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"fas","fa-chevron-right"]],template:function(e,i){e&1&&(n(0,"div",0),_(1,G,4,4,"div",1),r(),n(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h2",6),p(7,"i",7),n(8,"b"),o(9," Nature "),r(),o(10," - "),n(11,"i"),o(12,"Listing"),r(),o(13," - "),r(),n(14,"div",8)(15,"button",9),m("click",function(){return i.addNature()}),p(16,"i",10),o(17," Nouvelle nature "),r()()(),n(18,"div",11)(19,"div",12)(20,"div",13)(21,"div",14)(22,"input",15),E("ngModelChange",function(c){return I(i.searchTerm,c)||(i.searchTerm=c),c}),m("keyup.enter",function(){return i.search()}),r(),n(23,"div",16)(24,"button",17),m("click",function(){return i.search()}),p(25,"i",18),r()()()()(),_(26,J,3,1,"div",19)(27,K,3,0,"mat-progress-spinner",20)(28,X,15,1,"table",21)(29,Z,13,9,"div",22),r()()()()),e&2&&(s(),d("ngForOf",i.toasts),s(21),T("ngModel",i.searchTerm),s(4),d("ngIf",i.error),s(),d("ngIf",i.isLoading&&!i.error),s(),d("ngIf",!i.isLoading),s(),d("ngIf",i.totalPages>1))},dependencies:[O,w,M,k,R,D,F,L,z,j],styles:[".table-responsive[_ngcontent-%COMP%]{border-radius:8px;overflow:hidden;box-shadow:0 4px 12px #1111111a}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#5d83a9;color:#fff;text-align:center}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.table-row-hover[_ngcontent-%COMP%]:hover{background-color:#f1f3f5;transition:background .25s ease}.toast-container[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;display:flex;flex-direction:column;gap:10px;z-index:9999}.toast[_ngcontent-%COMP%]{min-width:220px;padding:12px 16px;border-radius:6px;color:#fff;box-shadow:0 4px 12px #00000040;font-size:14px;display:flex;justify-content:space-between;align-items:center;opacity:0;transform:translate(100%);transition:transform .4s ease,opacity .4s ease}.toast.show[_ngcontent-%COMP%]{opacity:1;transform:translate(0)}.toast.success[_ngcontent-%COMP%]{background-color:#4caf50}.toast.error[_ngcontent-%COMP%]{background-color:#f44336}.toast[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;font-size:16px;line-height:1;cursor:pointer}"]})};export{q as Natures};
