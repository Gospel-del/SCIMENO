import{a as G,c as U}from"./chunk-VMKVCHVW.js";import{b as O,e as P,f as k,g as A,i as W,j as D,n as L,o as z,p as q,s as R,t as j,u as B,w as H}from"./chunk-LTEV2KH7.js";import{i as I}from"./chunk-NKZL4UVF.js";import{$b as N,Fb as y,Hb as g,I as S,Ib as c,Oa as l,Pc as M,Qc as E,Rc as T,Sb as _,Ub as F,Wb as s,Yb as h,Yc as V,Za as b,ac as x,bc as v,db as C,ha as d,ia as p,ib as f,vb as u,wb as i,xb as a,yb as w}from"./chunk-S4NM23YD.js";function K(n,r){if(n&1){let e=y();i(0,"div",7),s(1),i(2,"button",8),g("click",function(){let t=d(e).$implicit,m=c();return p(m.closeToast(t))}),s(3,"\xD7"),a()()}if(n&2){let e=r.$implicit;F("show",e.visible),u("ngClass",e.type),l(),h(" ",e.message," ")}}function Q(n,r){n&1&&(i(0,"div"),s(1,"Le nom est requis."),a())}function X(n,r){n&1&&(i(0,"div"),s(1," Le nom doit comporter au moins 4 caract\xE8res. "),a())}function Y(n,r){if(n&1&&(i(0,"div",27),f(1,Q,2,0,"div",28)(2,X,2,0,"div",28),a()),n&2){c();let e=_(10);l(),u("ngIf",e.errors==null?null:e.errors.required),l(),u("ngIf",e.errors==null?null:e.errors.minlength)}}function Z(n,r){if(n&1&&(i(0,"option",29),s(1),a()),n&2){let e=r.$implicit;u("ngValue",e.key),l(),h(" ",e.label," ")}}function $(n,r){if(n&1){let e=y();i(0,"form",9,0),g("ngSubmit",function(){d(e);let t=c();return p(t.onSubmit())}),i(2,"div",10)(3,"div",11)(4,"label",12),s(5," Nom "),i(6,"span",13),s(7,"*"),a()(),i(8,"div",14)(9,"input",15,1),v("ngModelChange",function(t){d(e);let m=c();return x(m.nature.nomNature,t)||(m.nature.nomNature=t),p(t)}),a(),f(11,Y,3,2,"div",16),a()(),i(12,"div",11)(13,"label",17),s(14," Cat\xE9gorie "),i(15,"span",13),s(16,"*"),a()(),i(17,"div",14)(18,"select",18),v("ngModelChange",function(t){d(e);let m=c();return x(m.nature.typeNature,t)||(m.nature.typeNature=t),p(t)}),i(19,"option",19),s(20,"-- S\xE9lectionnez une categorie --"),a(),f(21,Z,2,2,"option",20),a()()(),i(22,"div",11)(23,"label",21),s(24," D\xE9tails "),a(),i(25,"div",14)(26,"textarea",22,2),v("ngModelChange",function(t){d(e);let m=c();return x(m.nature.detailNature,t)||(m.nature.detailNature=t),p(t)}),s(28,"        "),a()()()(),i(29,"div",23)(30,"button",24),w(31,"i",25),s(32),a(),i(33,"button",26),g("click",function(){d(e);let t=c();return p(t.close())}),s(34,"Fermer"),a()()()}if(n&2){let e=_(1),o=_(10),t=c();l(9),u("disabled",t.nature.idNature===-1||t.nature.idNature===-2),N("ngModel",t.nature.nomNature),l(2),u("ngIf",o.invalid&&(o.dirty||o.touched)),l(7),u("disabled",t.nature.idNature===-1||t.nature.idNature===-2),N("ngModel",t.nature.typeNature),l(3),u("ngForOf",t.typeCategorieList),l(5),N("ngModel",t.nature.detailNature),l(4),u("disabled",!e.form.valid||t.loading),l(2),h(" ",t.bSaveName," ")}}function ee(n,r){n&1&&(i(0,"h3",30),s(1,"Aucun nature \xE0 \xE9diter..."),a())}var J=class n{constructor(r,e){this.natureService=r;this.router=e}nature;isAddForm=!1;creationSuccess=!1;serverErrors=[];loading=!1;bSaveName="Enregistrer";typeCategorieList=Object.entries(G).map(([r,e])=>({key:r,label:e})).filter(r=>r.key!="EMP");toasts=[];showToast(r,e="success"){let o={message:r,type:e,visible:!1};this.toasts.push(o),requestAnimationFrame(()=>{o.visible=!0}),o.timeout=setTimeout(()=>this.closeToast(o),3e3)}closeToast(r){clearTimeout(r.timeout),r.visible=!1,setTimeout(()=>{this.toasts=this.toasts.filter(e=>e!==r)},400)}ngOnInit(){this.isAddForm=!1,this.bSaveName="Enregistrer",this.nature&&(this.router.url.includes("/create")||this.nature.idNature==-10)&&(this.isAddForm=!0),this.isAddForm||(this.bSaveName="Modifier")}close(){this.router.navigate(["natures/"])}onSubmit(){this.creationSuccess=!1,this.serverErrors=[],this.loading=!0,this.nature&&(this.isAddForm?this.natureService.createNature(this.nature):this.natureService.updateNature(this.nature)).pipe(S(()=>this.loading=!1)).subscribe({next:e=>{e?(this.creationSuccess=!0,console.log("Sauvegarde r\xE9ussie",e),this.isAddForm?(this.nature={idNature:-5,nomNature:"",typeNature:"",detailNature:"",status:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},this.showToast(["Sauvegarde r\xE9ussie !"],"success")):this.showToast(["Modification r\xE9ussie !"],"success")):this.showToast(["Une erreur est survenue lors de l'enregistrement"],"error")},error:e=>{this.serverErrors.push(e.error?.message||"Erreur inconnue."),this.showToast(this.serverErrors,"error")}})}static \u0275fac=function(e){return new(e||n)(b(U),b(I))};static \u0275cmp=C({type:n,selectors:[["app-natures-form"]],inputs:{nature:"nature"},decls:4,vars:3,consts:[["natureForm","ngForm"],["nomNature","ngModel"],["detailNature","ngModel"],[1,"toast-container"],["class","toast",3,"ngClass","show",4,"ngFor","ngForOf"],["class","form-horizontal",3,"ngSubmit",4,"ngIf"],["class","center",4,"ngIf"],[1,"toast",3,"ngClass"],[1,"close-btn",3,"click"],[1,"form-horizontal",3,"ngSubmit"],[1,"card-body"],[1,"form-group","row"],["for","nomNature",1,"col-sm-2","col-form-label"],[1,"text-danger"],[1,"col-sm-10"],["type","text","id","nomNature","placeholder","Nom","required","","minlength","4","maxlength","150","name","nomNature",1,"form-control",3,"ngModelChange","disabled","ngModel"],["class","alertInput",4,"ngIf"],["for","typeNature",1,"col-sm-2","col-form-label"],["data-select2-id","1","tabindex","-1","aria-hidden","true","required","","name","typeNature",1,"form-control","select2","select2-hidden-accessible",2,"width","100%",3,"ngModelChange","disabled","ngModel"],["value","","disabled","","selected",""],[3,"ngValue",4,"ngFor","ngForOf"],["for","detailNature",1,"col-sm-2","col-form-label"],["aria-label","With textarea","id","detailNature","placeholder","D\xE9tail","name","detailNature",1,"form-control",3,"ngModelChange","ngModel"],[1,"card-footer"],["type","submit",1,"btn","btn-info",3,"disabled"],[1,"fas","fa-save","mr-2"],["type","button",1,"btn","btn-secondary","float-end",3,"click"],[1,"alertInput"],[4,"ngIf"],[3,"ngValue"],[1,"center"]],template:function(e,o){e&1&&(i(0,"div",3),f(1,K,4,4,"div",4),a(),f(2,$,35,9,"form",5)(3,ee,2,0,"h3",6)),e&2&&(l(),u("ngForOf",o.toasts),l(),u("ngIf",o.nature),l(),u("ngIf",!o.nature))},dependencies:[V,M,E,T,H,D,z,q,O,L,P,k,R,j,B,W,A],styles:[".toast-container[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;display:flex;flex-direction:column;gap:10px;z-index:9999}.toast[_ngcontent-%COMP%]{min-width:220px;padding:12px 16px;border-radius:6px;color:#fff;box-shadow:0 4px 12px #00000040;font-size:14px;display:flex;justify-content:space-between;align-items:center;opacity:0;transform:translate(100%);transition:transform .4s ease,opacity .4s ease}.toast.show[_ngcontent-%COMP%]{opacity:1;transform:translate(0)}.toast.success[_ngcontent-%COMP%]{background-color:#4caf50}.toast.error[_ngcontent-%COMP%]{background-color:#f44336}.toast[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;font-size:16px;line-height:1;cursor:pointer}"]})};export{J as a};
