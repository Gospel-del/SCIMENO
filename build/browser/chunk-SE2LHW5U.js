import{y as m}from"./chunk-LTEV2KH7.js";import{c as d,m as s,q as U}from"./chunk-NKZL4UVF.js";import{B as a,U as h,Z as c,ba as o,g as u,l as r,m as p,p as i}from"./chunk-S4NM23YD.js";var b=class n{constructor(t,e,l){this.http=t;this.authService=e;this.authHelper=l;this.loadUserFromStorage()}apiUrl="http://localhost:5000/api/auth";currentUserSubject=new u(null);currentUser$=this.currentUserSubject.asObservable();_userToEdit=null;setUserToEdit(t){this._userToEdit=t}getUserToEdit(){return this._userToEdit}clearUserToEdit(){this._userToEdit=null}getAuthHeaders(){return this.authHelper.getAuthHeaders("UserService")}loadUserFromStorage(){let t=localStorage.getItem("currentUser");if(t)try{let e=JSON.parse(t);this.currentUserSubject.next(new s(e))}catch(e){console.error("Erreur lors du chargement de l'utilisateur:",e),localStorage.removeItem("currentUser")}}saveUserToStorage(t){t?localStorage.setItem("currentUser",JSON.stringify(t.toDict())):localStorage.removeItem("currentUser")}getCurrentUser(){return this.currentUserSubject.value}setCurrentUser(t){this.currentUserSubject.next(t),this.saveUserToStorage(t)}login(t){return this.http.post(`${this.apiUrl}/login`,t).pipe(i(e=>s.fromResponse(e)),h(e=>this.setCurrentUser(e)))}logout(){this.setCurrentUser(null)}getAllUsers(t,e,l=!1){if(!this.getAuthHeaders())return r(null);let g={page:t,per_page:e,actifOnly:l};return this.http.post(`${this.apiUrl}/liste_utilisateurs`,g,this.getAuthHeaders()).pipe(a(v=>this.handleError(v,null)))}getUserById(t){return this.http.get(`${this.apiUrl}/users/${t}`).pipe(i(e=>s.fromResponse(e)))}getUserByEmail(t){return this.http.get(`${this.apiUrl}/users/email/${t}`).pipe(i(e=>s.fromResponse(e)))}createUser(t){return this.getAuthHeaders()?this.http.post(`${this.apiUrl}/creer_utilisateur`,t,this.getAuthHeaders()).pipe(i(e=>{if(e.success&&e.data)return s.fromResponse(e.data);throw new Error(e.message||"Erreur lors de la cr\xE9ation de l'utilisateur")}),a(e=>this.handleError(e,void 0))):r(null)}handleError(t,e){return console.log("error = ",t),r(e)}updateUser(t){return this.getAuthHeaders()?(console.log("userData = ",t),this.http.post(`${this.apiUrl}/modifier_utilisateur`,t,this.getAuthHeaders()).pipe(i(e=>{if(e.success&&e.data)return s.fromResponse(e.data);throw new Error(e.message||"Erreur lors de la modification de l'utilisateur")}),a(e=>this.handleError(e,void 0)))):r(null)}deleteUser(t){return this.getAuthHeaders()?this.http.delete(`${this.apiUrl}/users/${t}`):r(null)}updatePassword(t){return this.getAuthHeaders()?this.http.post(`${this.apiUrl}/changer_mot_de_passe`,t,this.getAuthHeaders()):r(null)}isLoggedIn(){return this.currentUserSubject.value!==null}hasRole(t){let e=this.getCurrentUser();return e?e.fonction===t:!1}isAdmin(){return this.hasRole("Administrateur")}isManager(){return this.hasRole("Gestionnaire")}searchUsers(t){return this.getAuthHeaders()?this.http.get(`${this.apiUrl}/users/search?q=${encodeURIComponent(t)}`,this.getAuthHeaders()).pipe(a(e=>this.handleError(e,null))):r(null)}getUserStats(){return this.getAuthHeaders()?this.http.get(`${this.apiUrl}/users/stats`,this.getAuthHeaders()):r(null)}exportUsers(t="csv"){return this.http.get(`${this.apiUrl}/users/export?format=${t}`,{responseType:"blob"})}forgotPassword(t){return this.http.post(`${this.apiUrl}/mot_de_passe_oublie`,{email:t}).pipe(a(e=>(console.error("Erreur lors de la demande de r\xE9initialisation:",e),p(()=>e))))}importUsers(t){let e=new FormData;return e.append("file",t),this.http.post(`${this.apiUrl}/users/import`,e)}static \u0275fac=function(e){return new(e||n)(o(d),o(U),o(m))};static \u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})};export{b as a};
