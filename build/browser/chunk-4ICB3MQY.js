import{c as B}from"./chunk-TND3ERBF.js";import{a as A}from"./chunk-3ICLOKWM.js";import{a as x,b as I,e as k,f as N,g as T,i as W,j as L,s as D,t as P,w as R}from"./chunk-LTEV2KH7.js";import{i as j}from"./chunk-NKZL4UVF.js";import{$b as _,Fb as y,Hb as g,Ib as w,Oa as c,Rc as V,Sb as h,Wb as o,Yb as M,Yc as F,Za as v,ac as S,bc as C,db as E,ha as d,ia as u,ib as b,vb as f,wb as t,xb as n,yb as p}from"./chunk-S4NM23YD.js";import"./chunk-CSTXWUWE.js";function q(m,s){if(m&1&&(t(0,"div",27),p(1,"i",28),o(2),n()),m&2){let r=w();c(2),M(" ",r.error," ")}}function O(m,s){m&1&&(t(0,"span"),o(1,"Cr\xE9er le sc\xE9nario"),n())}function U(m,s){m&1&&(t(0,"span"),p(1,"i",29),o(2," Cr\xE9ation en cours... "),n())}var G=class m{constructor(s,r,e){this.globalFonctionService=s;this.scenariosService=r;this.router=e}scenario={nom_scenario:"",coef_majoration:0,description:"",actif:!0};loading=!1;error=null;ngOnInit(){}onSubmit(s){if(!s.invalid){if(this.loading=!0,this.error=null,this.scenario.coef_majoration<0||this.scenario.coef_majoration>1){this.error="Le coefficient de majoration doit \xEAtre entre 0 et 1",this.loading=!1;return}this.scenariosService.createScenario(this.scenario).subscribe({next:r=>{r?this.router.navigate(["/scenarios"]):(this.error="Erreur lors de la cr\xE9ation du sc\xE9nario",this.loading=!1)},error:r=>{this.error=r.error?.message||"Erreur lors de la cr\xE9ation du sc\xE9nario",this.loading=!1,console.error("Erreur:",r)}})}}checkMax(s,r,e,a){let l=this.globalFonctionService.limitValue(s.target.value,r,e);s.target.value=l,a&&a.control.setValue(l,{emitEvent:!1})}onCancel(){this.router.navigate(["/scenarios"])}resetForm(s){s.resetForm(),this.scenario={nom_scenario:"",coef_majoration:0,description:"",actif:!0},this.error=null}static \u0275fac=function(r){return new(r||m)(v(A),v(B),v(j))};static \u0275cmp=E({type:m,selectors:[["app-scenarios-create"]],decls:44,vars:8,consts:[["scenarioForm","ngForm"],[1,"col-md-12"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"fas","fa-plus","mr-2"],[1,"card-body"],["class","alert alert-danger",4,"ngIf"],[3,"ngSubmit"],[1,"form-group"],["for","nom_scenario"],["type","text","id","nom_scenario","name","nom_scenario","required","","minlength","3","placeholder","Ex: Sc\xE9nario optimiste",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-text","text-muted"],["for","coef_majoration"],["type","text","id","coef_majoration","name","coef_majoration","required","","min","0","max","1","step","0.01","placeholder","Ex: 0.15 pour 15%",1,"form-control",3,"ngModelChange","input","ngModel"],["for","description"],["id","description","name","description","rows","4","placeholder","Description du sc\xE9nario (optionnel)",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-check"],["type","checkbox","id","actif","name","actif",1,"form-check-input",3,"ngModelChange","ngModel"],["for","actif",1,"form-check-label"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"fas","fa-save","mr-2"],[4,"ngIf"],["type","button",1,"btn","btn-secondary","ml-2",3,"click"],[1,"fas","fa-times","mr-2"],["type","button",1,"btn","btn-outline-secondary","ml-2",3,"click"],[1,"fas","fa-redo","mr-2"],[1,"alert","alert-danger"],[1,"fas","fa-exclamation-triangle"],[1,"fas","fa-spinner","fa-spin","mr-2"]],template:function(r,e){if(r&1){let a=y();t(0,"div",1)(1,"div",2)(2,"div",3)(3,"h3",4),p(4,"i",5),o(5," Cr\xE9er un nouveau sc\xE9nario "),n()(),t(6,"div",6),b(7,q,3,1,"div",7),t(8,"form",8,0),g("ngSubmit",function(){d(a);let i=h(9);return u(e.onSubmit(i))}),t(10,"div",9)(11,"label",10),o(12,"Nom du sc\xE9nario *"),n(),t(13,"input",11),C("ngModelChange",function(i){return d(a),S(e.scenario.nom_scenario,i)||(e.scenario.nom_scenario=i),u(i)}),n(),t(14,"small",12),o(15,"Le nom doit contenir au moins 3 caract\xE8res"),n()(),t(16,"div",9)(17,"label",13),o(18,"Coefficient de majoration *"),n(),t(19,"input",14),C("ngModelChange",function(i){return d(a),S(e.scenario.coef_majoration,i)||(e.scenario.coef_majoration=i),u(i)}),g("input",function(i){return d(a),u(e.checkMax(i,0,1,e.scenario.coef_majoration))}),n(),t(20,"small",12),o(21," Valeur entre 0 et 1 (ex: 0.15 = 15% de majoration) "),n()(),t(22,"div",9)(23,"label",15),o(24,"Description"),n(),t(25,"textarea",16),C("ngModelChange",function(i){return d(a),S(e.scenario.description,i)||(e.scenario.description=i),u(i)}),n()(),t(26,"div",9)(27,"div",17)(28,"input",18),C("ngModelChange",function(i){return d(a),S(e.scenario.actif,i)||(e.scenario.actif=i),u(i)}),n(),t(29,"label",19),o(30," Sc\xE9nario actif "),n()(),t(31,"small",12),o(32," Un sc\xE9nario actif peut \xEAtre utilis\xE9 dans les calculs "),n()(),t(33,"div",9)(34,"button",20),p(35,"i",21),b(36,O,2,0,"span",22)(37,U,3,0,"span",22),n(),t(38,"button",23),g("click",function(){return d(a),u(e.onCancel())}),p(39,"i",24),o(40," Annuler "),n(),t(41,"button",25),g("click",function(){d(a);let i=h(9);return u(e.resetForm(i))}),p(42,"i",26),o(43," R\xE9initialiser "),n()()()()()()}if(r&2){let a=h(9);c(7),f("ngIf",e.error),c(6),_("ngModel",e.scenario.nom_scenario),c(6),_("ngModel",e.scenario.coef_majoration),c(6),_("ngModel",e.scenario.description),c(3),_("ngModel",e.scenario.actif),c(6),f("disabled",!a.valid||e.loading),c(2),f("ngIf",!e.loading),c(),f("ngIf",e.loading)}},dependencies:[F,V,R,L,I,x,k,N,D,P,W,T],encapsulation:2})};export{G as ScenariosCreateComponent};
