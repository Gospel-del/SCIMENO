import{a as S,b as j}from"./chunk-C5B75LPH.js";import{a as $}from"./chunk-IJB3HI4L.js";import{a as z,b as A}from"./chunk-MNJUUXAV.js";import{c as W}from"./chunk-Y2GQIFGB.js";import"./chunk-6C43PQNK.js";import"./chunk-SGGM3K3A.js";import{b as D,e as L,i as N,w as R}from"./chunk-LTEV2KH7.js";import{i as F}from"./chunk-NKZL4UVF.js";import{$b as T,Fb as C,Hb as p,Ib as m,Oa as s,Pc as k,Qc as M,Rc as O,Ub as x,Wb as o,Xb as _,Yb as b,Yc as V,Za as v,_b as y,ac as P,bc as I,db as E,ha as g,hc as w,ia as f,ib as h,vb as u,wb as i,xb as n,yb as d}from"./chunk-S4NM23YD.js";import"./chunk-CSTXWUWE.js";var q=()=>[];function B(a,t){if(a&1){let e=C();i(0,"div",23),o(1),i(2,"button",24),p("click",function(){let l=g(e).$implicit,c=m();return f(c.closeToast(l))}),o(3,"\xD7"),n()()}if(a&2){let e=t.$implicit;x("show",e.visible),u("ngClass",e.type),s(),b(" ",e.message," ")}}function G(a,t){if(a&1&&(i(0,"div",25),d(1,"i",26),o(2),n()),a&2){let e=m();s(2),b(" ",e.error," ")}}function J(a,t){a&1&&d(0,"mat-progress-spinner",27)}function K(a,t){if(a&1){let e=C();i(0,"tr")(1,"td"),o(2),n(),i(3,"td"),o(4),n(),i(5,"td"),o(6),n(),i(7,"td"),o(8),n(),i(9,"td"),o(10),n(),i(11,"td"),o(12),n(),i(13,"td")(14,"div",31)(15,"button",32),p("click",function(){let l=g(e).$implicit,c=m(2);return f(c.updateClient(l))}),d(16,"i",33),o(17," Modifier "),n(),i(18,"button",34),p("click",function(){let l=g(e).$implicit,c=m(2);return f(c.supprimerClient(l))}),d(19,"i",35),o(20," Supprimer "),n()()()()}if(a&2){let e=t.$implicit;s(2),_(e.idClient),s(2),_(e.nom),s(2),_(e.prenom),s(2),_(e.email),s(2),_(e.telephone),s(2),_(e.entreprise)}}function Q(a,t){if(a&1&&(i(0,"table",28)(1,"thead",29)(2,"tr")(3,"th"),o(4,"ID"),n(),i(5,"th"),o(6,"Nom"),n(),i(7,"th"),o(8,"Pr\xE9nom"),n(),i(9,"th"),o(10,"Email"),n(),i(11,"th"),o(12,"T\xE9l\xE9phone"),n(),i(13,"th"),o(14,"Entreprise"),n(),i(15,"th"),o(16,"Actions"),n()()(),i(17,"tbody"),h(18,K,21,6,"tr",30),n()()),a&2){let e=m();s(18),u("ngForOf",e.clients)}}function U(a,t){if(a&1){let e=C();i(0,"li",39)(1,"a",40),p("click",function(l){let c=g(e).index;return m(2).goToPage(c+1),f(l.preventDefault())}),o(2),n()()}if(a&2){let e=t.index,r=m(2);x("active",r.pageIndex===e+1),s(2),b(" ",e+1," ")}}function X(a,t){if(a&1){let e=C();i(0,"div",36)(1,"div")(2,"p",37),o(3),n()(),i(4,"nav")(5,"ul",38)(6,"li",39)(7,"a",40),p("click",function(l){return g(e),m().previousPage(),f(l.preventDefault())}),d(8,"i",41),n()(),h(9,U,3,3,"li",42),i(10,"li",39)(11,"a",40),p("click",function(l){return g(e),m().nextPage(),f(l.preventDefault())}),d(12,"i",43),n()()()()()}if(a&2){let e=m();s(3),y(" Page ",e.pageIndex," sur ",e.totalPages," (",e.total," nature(s) au total) "),s(3),x("disabled",e.pageIndex===1),s(3),u("ngForOf",w(8,q).constructor(e.totalPages)),s(),x("disabled",e.pageIndex===e.totalPages)}}var H=class a{constructor(t,e,r){this.clientService=t;this.router=e;this.dialog=r}pageIndex=1;pageSize=10;total=0;totalPages=0;Math=Math;isLoading=!0;error="";searchTerm="";clients=[];toasts=[];showToast(t,e="success"){let r={message:t,type:e,visible:!1};this.toasts.push(r),requestAnimationFrame(()=>{r.visible=!0}),r.timeout=setTimeout(()=>this.closeToast(r),3e3)}closeToast(t){clearTimeout(t.timeout),t.visible=!1,setTimeout(()=>{this.toasts=this.toasts.filter(e=>e!==t)},400)}ngOnInit(){this.loadClients()}loadClients(){this.isLoading=!0,this.clientService.listClients(this.pageIndex,this.pageSize).subscribe({next:t=>{t&&t.success&&t.data?(this.clients=t.data.clients.map(e=>S.fromResponse(e)),this.total=t.data.total,this.totalPages=t.data.total_pages,this.pageIndex=t.data.page):(this.error=t?.message||"Erreur lors du chargement des clients",this.clients=[]),this.isLoading=!1},error:t=>{this.error="Erreur lors du chargement des clients",this.isLoading=!1,console.error("Erreur:",t)}})}goToPage(t){t>=1&&t<=this.totalPages&&(this.pageIndex=t,this.loadClients())}previousPage(){this.pageIndex>1&&(this.pageIndex--,this.loadClients())}nextPage(){this.pageIndex<this.totalPages&&(this.pageIndex++,this.loadClients())}addClient(){this.router.navigate(["clients/create"])}search(){if(this.searchTerm.trim().length===0){this.loadClients();return}this.isLoading=!0,this.error=null,this.clientService.searchClient(this.searchTerm).subscribe({next:t=>{t&&t.success&&t.data?(this.clients=t.data.map(e=>S.fromResponse(e)),this.total=this.clients.length,this.totalPages=1):(this.error=t?.message||"Aucun client trouv\xE9e",this.clients=[]),this.isLoading=!1},error:t=>{this.error="Erreur lors de la recherche",this.isLoading=!1,console.error("Erreur:",t)}})}supprimerClient(t){this.dialog.open($,{width:"350px",data:{title:"Confirmation",message:"Voulez-vous vraiment supprimer le client "+t.prenom+" "+t.nom+" ?",cancel:"Non",valid:"Oui"}}).afterClosed().subscribe(r=>{r===!0&&this.clientService.deleteClient(t).subscribe(l=>{this.showToast(["Suppression r\xE9ussie !"],"success"),this.loadClients()},l=>{let c=[];c.push(l.error?.message||"Erreur inconnue."),this.showToast(c,"error")})})}updateClient(t){this.clientService.setClientToEdit(t),this.router.navigate(["clients/edit"])}static \u0275fac=function(e){return new(e||a)(v(j),v(F),v(W))};static \u0275cmp=E({type:a,selectors:[["app-clients"]],decls:30,vars:6,consts:[[1,"toast-container"],["class","toast",3,"ngClass","show",4,"ngFor","ngForOf"],[1,"row"],[1,"col-12"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"fas","fa-user-tie","mr-2"],[1,"card-tools"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus"],[1,"card-body"],[1,"row","mb-3"],[1,"col-md-6"],[1,"input-group"],["type","text","placeholder","Rechercher un client...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],[1,"input-group-append"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-search"],["class","alert alert-danger",4,"ngIf"],["mode","indeterminate","diameter","50","style","display: block; margin: 0 auto;",4,"ngIf"],["class","table table-bordered table-hover",4,"ngIf"],["class","d-flex justify-content-between align-items-center mt-3",4,"ngIf"],[1,"toast",3,"ngClass"],[1,"close-btn",3,"click"],[1,"alert","alert-danger"],[1,"fas","fa-exclamation-triangle"],["mode","indeterminate","diameter","50",2,"display","block","margin","0 auto"],[1,"table","table-bordered","table-hover"],[1,"thead-dark"],[4,"ngFor","ngForOf"],["role","group",1,"btn-group"],[1,"btn","btn-sm","btn-info","mr-1",3,"click"],[1,"fas","fa-edit"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"fas","fa-trash"],[1,"d-flex","justify-content-between","align-items-center","mt-3"],[1,"text-muted","mb-0"],[1,"pagination","mb-0"],[1,"page-item"],["href","#",1,"page-link",3,"click"],[1,"fas","fa-chevron-left"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"fas","fa-chevron-right"]],template:function(e,r){e&1&&(i(0,"div",0),h(1,B,4,4,"div",1),n(),i(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h2",6),d(7,"i",7),i(8,"b"),o(9," Client "),n(),o(10," - "),i(11,"i"),o(12,"Listing"),n(),o(13," - "),n(),i(14,"div",8)(15,"button",9),p("click",function(){return r.addClient()}),d(16,"i",10),o(17," Nouveau client "),n()()(),i(18,"div",11)(19,"div",12)(20,"div",13)(21,"div",14)(22,"input",15),I("ngModelChange",function(c){return P(r.searchTerm,c)||(r.searchTerm=c),c}),p("keyup.enter",function(){return r.search()}),n(),i(23,"div",16)(24,"button",17),p("click",function(){return r.search()}),d(25,"i",18),n()()()()(),h(26,G,3,1,"div",19)(27,J,1,0,"mat-progress-spinner",20)(28,Q,19,1,"table",21)(29,X,13,9,"div",22),n()()()()),e&2&&(s(),u("ngForOf",r.toasts),s(21),T("ngModel",r.searchTerm),s(4),u("ngIf",r.error),s(),u("ngIf",r.isLoading),s(),u("ngIf",!r.isLoading),s(),u("ngIf",r.totalPages>1))},dependencies:[V,k,M,O,R,D,L,N,A,z],styles:[".table-responsive[_ngcontent-%COMP%]{border-radius:8px;overflow:hidden;box-shadow:0 4px 12px #1111111a}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#5d83a9;color:#fff;text-align:center}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.table-row-hover[_ngcontent-%COMP%]:hover{background-color:#f1f3f5;transition:background .25s ease}.toast-container[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;display:flex;flex-direction:column;gap:10px;z-index:9999}.toast[_ngcontent-%COMP%]{min-width:220px;padding:12px 16px;border-radius:6px;color:#fff;box-shadow:0 4px 12px #00000040;font-size:14px;display:flex;justify-content:space-between;align-items:center;opacity:0;transform:translate(100%);transition:transform .4s ease,opacity .4s ease}.toast.show[_ngcontent-%COMP%]{opacity:1;transform:translate(0)}.toast.success[_ngcontent-%COMP%]{background-color:#4caf50}.toast.error[_ngcontent-%COMP%]{background-color:#f44336}.toast[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;font-size:16px;line-height:1;cursor:pointer}"]})};export{H as ClientsComponent};
