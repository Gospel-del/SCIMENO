import{a as ee}from"./chunk-L76IVEF3.js";import{d as U,f as J,j as K,k as Q}from"./chunk-ZJQO5VS5.js";import{a as $}from"./chunk-3ICLOKWM.js";import{b as Z}from"./chunk-AWQM7IIM.js";import{a as X,c as Y}from"./chunk-VMKVCHVW.js";import{a as H}from"./chunk-MNJUUXAV.js";import{b as D,e as L,f as k,g as P,h as W,i as R,j as A,s as j,t as q,u as z,w as G,x as B}from"./chunk-LTEV2KH7.js";import{i as O}from"./chunk-NKZL4UVF.js";import{$b as h,Fb as x,Hb as N,I as C,Ib as c,Oa as u,Pc as I,Qc as T,Rc as E,Sb as S,Ub as w,Wb as m,Yb as y,Yc as V,Za as f,ac as _,bc as v,db as M,ha as d,ia as p,ib as g,vb as l,wb as s,xb as n,yb as b,zc as F}from"./chunk-S4NM23YD.js";function re(o,i){o&1&&b(0,"mat-progress-spinner",7)}function ie(o,i){if(o&1){let e=x();s(0,"div",8),m(1),s(2,"button",9),N("click",function(){let r=d(e).$implicit,a=c();return p(a.closeToast(r))}),m(3,"\xD7"),n()()}if(o&2){let e=i.$implicit;w("show",e.visible),l("ngClass",e.type),u(),y(" ",e.message," ")}}function oe(o,i){o&1&&(s(0,"div"),m(1,"Le nom est requis."),n())}function se(o,i){o&1&&(s(0,"div"),m(1," Le nom doit comporter au moins 4 caract\xE8res. "),n())}function ae(o,i){if(o&1&&(s(0,"div",26),g(1,oe,2,0,"div",27)(2,se,2,0,"div",27),n()),o&2){c();let e=S(10);u(),l("ngIf",e.errors==null?null:e.errors.required),u(),l("ngIf",e.errors==null?null:e.errors.minlength)}}function ne(o,i){if(o&1){let e=x();s(0,"form",10,0),N("ngSubmit",function(){d(e);let r=c();return p(r.onSubmit())}),s(2,"div",11)(3,"div",12)(4,"label",13),m(5,"Nom "),s(6,"span",14),m(7,"*"),n()(),s(8,"div",15)(9,"input",16,1),v("ngModelChange",function(r){d(e);let a=c();return _(a.sousNature.nomSousNature,r)||(a.sousNature.nomSousNature=r),p(r)}),n(),g(11,ae,3,2,"div",17),n()(),s(12,"div",12)(13,"label",18),m(14,"Nature "),s(15,"span",14),m(16,"*"),n()(),s(17,"div",15)(18,"select2",19),v("ngModelChange",function(r){d(e);let a=c();return _(a.selectedNatureId,r)||(a.selectedNatureId=r),p(r)}),n()()(),s(19,"div",12)(20,"label",20),m(21,"D\xE9tails"),n(),s(22,"div",15)(23,"textarea",21),v("ngModelChange",function(r){d(e);let a=c();return _(a.sousNature.detailSousNature,r)||(a.sousNature.detailSousNature=r),p(r)}),n()()()(),s(24,"div",22)(25,"button",23),b(26,"i",24),m(27),n(),s(28,"button",25),N("click",function(){d(e);let r=c();return p(r.close())}),m(29,"Fermer"),n()()()}if(o&2){let e=S(1),t=S(10),r=c();u(9),l("disabled",r.sousNature.idSousNature===-1||r.sousNature.idSousNature===-2),h("ngModel",r.sousNature.nomSousNature),u(2),l("ngIf",t.invalid&&(t.dirty||t.touched)),u(7),l("data",r.data),h("ngModel",r.selectedNatureId),l("styleMode","noStyle")("placeholder","S\xE9lectionner une nature"),u(5),h("ngModel",r.sousNature.detailSousNature),u(2),l("disabled",!e.form.valid),u(2),y(" ",r.bSaveName," ")}}function ue(o,i){o&1&&(s(0,"h3",28),m(1,"Aucun sousNature \xE0 \xE9diter..."),n())}var te=class o{constructor(i,e,t,r,a){this.sousNatureService=i;this.natureService=e;this.globalFonctionService=t;this.cdr=r;this.router=a}sousNature;natures=[];newNatures=[];filteredNatures;natureControl=new W("");pageIndex=1;pageSize=10;totalNature=0;isLoading=!1;isAddForm=!1;bSaveName="Enregistrer";serverErrors=[];creationSuccess=!1;loading=!1;data=[];selectedNatureId="";typeCategorieList;toasts=[];showToast(i,e="success"){let t={message:i,type:e,visible:!1};this.toasts.push(t),requestAnimationFrame(()=>{t.visible=!0}),t.timeout=setTimeout(()=>this.closeToast(t),3e3)}closeToast(i){clearTimeout(i.timeout),i.visible=!1,setTimeout(()=>{this.toasts=this.toasts.filter(e=>e!==i)},400)}ngOnInit(){this.typeCategorieList=Object.entries(X).map(([i,e])=>({key:i,label:e})),this.loadNatures(),this.sousNature&&(this.router.url.includes("/create")||this.sousNature.idSousNature===-1)&&(this.isAddForm=!0),this.bSaveName=this.isAddForm?"Enregistrer":"Modifier"}onNatureChange(i){this.sousNature.idNature=Number(i)}loadNatures(){this.isLoading=!0,this.natureService.listNatures(0,1e3).subscribe({next:i=>{this.natures=i.data.base_natures,this.totalNature=i.data.total,this.newNatures=this.globalFonctionService.mergeUnique(this.newNatures,this.natures,e=>e.idNature),this.data=this.buildSelect2Data(this.newNatures,this.typeCategorieList),setTimeout(()=>{this.sousNature?.idNature?this.selectedNatureId=this.sousNature.idNature.toString():this.selectedNatureId="",this.isLoading=!1,this.cdr.detectChanges()})},error:()=>this.isLoading=!1})}buildSelect2Data(i,e){return e.map(t=>{console.log("cat = ",t);let r=i.filter(a=>a.typeNature===t.key).map(a=>({value:a.idNature.toString(),label:a.nomNature,id:a.idNature.toString()}));return{label:t.label,data:{name:t.key},options:r}}).filter(t=>t.options.length>0)}onNatureSelected(i){let e=i.option.value,t=this.natures.find(r=>r.nomNature===e);t&&(this.sousNature.idNature=t.idNature)}onSubmit(){this.creationSuccess=!1,this.serverErrors=[],this.loading=!0,this.sousNature.idNature=+this.selectedNatureId,(this.isAddForm?this.sousNatureService.createSousNature(this.sousNature):this.sousNatureService.updateSousNature(this.sousNature)).pipe(C(()=>this.loading=!1)).subscribe({next:e=>{e?(this.creationSuccess=!0,console.log("Sauvegarde r\xE9ussie",e),this.isAddForm?(this.selectedNatureId="",this.sousNature={idSousNature:-5,idNature:-5,nomSousNature:"",detailSousNature:"",status:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},this.showToast(["Sauvegarde r\xE9ussie !"],"success")):this.showToast(["Modification r\xE9ussie !"],"success")):this.showToast(["Une erreur est survenue lors de l'enregistrement"],"error")},error:e=>{this.serverErrors.push(e.error?.message||"Erreur inconnue."),this.showToast(this.serverErrors,"error")}})}close(){this.router.navigate(["sous-natures/"])}static \u0275fac=function(e){return new(e||o)(f(Z),f(Y),f($),f(F),f(O))};static \u0275cmp=M({type:o,selectors:[["app-sous-nature-form"]],inputs:{sousNature:"sousNature"},decls:5,vars:4,consts:[["sousNatureForm","ngForm"],["nomSousNature","ngModel"],["mode","indeterminate","diameter","50","style","display: block; margin: 0 auto;",4,"ngIf"],[1,"toast-container"],["class","toast",3,"ngClass","show",4,"ngFor","ngForOf"],["class","form-horizontal",3,"ngSubmit",4,"ngIf"],["class","center",4,"ngIf"],["mode","indeterminate","diameter","50",2,"display","block","margin","0 auto"],[1,"toast",3,"ngClass"],[1,"close-btn",3,"click"],[1,"form-horizontal",3,"ngSubmit"],[1,"card-body"],[1,"form-group","row"],["for","nomSousNature",1,"col-sm-2","col-form-label"],[1,"text-danger"],[1,"col-sm-10"],["type","text","id","nomSousNature","placeholder","Nom","required","","minlength","4","maxlength","150","name","nomSousNature",1,"form-control",3,"ngModelChange","disabled","ngModel"],["class","alertInput",4,"ngIf"],["for","typeNature",1,"col-sm-2","col-form-label"],["required","","name","selectedNatureId",1,"form-control",3,"ngModelChange","data","ngModel","styleMode","placeholder"],["for","detailSousNature",1,"col-sm-2","col-form-label"],["aria-label","With textarea","id","detailSousNature","placeholder","D\xE9tails","name","detailSousNature",1,"form-control",3,"ngModelChange","ngModel"],[1,"card-footer"],["type","submit",1,"btn","btn-info",3,"disabled"],[1,"fas","fa-save","mr-2"],["type","button",1,"btn","btn-secondary","float-end",3,"click"],[1,"alertInput"],[4,"ngIf"],[1,"center"]],template:function(e,t){e&1&&(g(0,re,1,0,"mat-progress-spinner",2),s(1,"div",3),g(2,ie,4,4,"div",4),n(),g(3,ne,30,10,"form",5)(4,ue,2,0,"h3",6)),e&2&&(l("ngIf",t.isLoading),u(2),l("ngForOf",t.toasts),u(),l("ngIf",t.sousNature&&!t.isLoading),u(),l("ngIf",!t.sousNature))},dependencies:[G,A,D,L,k,j,q,z,R,P,B,U,J,K,V,I,T,E,Q,ee,H],styles:[".toast-container[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;display:flex;flex-direction:column;gap:10px;z-index:9999}.toast[_ngcontent-%COMP%]{min-width:220px;padding:12px 16px;border-radius:6px;color:#fff;box-shadow:0 4px 12px #00000040;font-size:14px;display:flex;justify-content:space-between;align-items:center;opacity:0;transform:translate(100%);transition:transform .4s ease,opacity .4s ease}.toast.show[_ngcontent-%COMP%]{opacity:1;transform:translate(0)}.toast.success[_ngcontent-%COMP%]{background-color:#4caf50}.toast.error[_ngcontent-%COMP%]{background-color:#f44336}.toast[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;font-size:16px;line-height:1;cursor:pointer}"]})};export{te as a};
