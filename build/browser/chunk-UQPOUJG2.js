import{a as G}from"./chunk-SE2LHW5U.js";import{c as J,g as K,j as Q}from"./chunk-Y2GQIFGB.js";import{b as O,e as P,f as W,g as D,i as L,j as A,n as k,o as q,p as z,s as B,t as R,u as j,w as H}from"./chunk-LTEV2KH7.js";import{i as V,n as I,o as N}from"./chunk-NKZL4UVF.js";import{$b as g,Fb as M,Hb as v,I as y,Ib as d,Oa as l,Pc as E,Qc as F,Rc as U,Sb as b,Ub as C,Wb as a,Yb as S,Yc as T,Za as x,ac as _,bc as h,db as w,ha as u,ia as p,ib as f,vb as c,wb as i,xb as r}from"./chunk-S4NM23YD.js";function Y(s,o){if(s&1){let e=M();i(0,"div",9),a(1),i(2,"button",10),v("click",function(){let t=u(e).$implicit,m=d();return p(m.closeToast(t))}),a(3,"\xD7"),r()()}if(s&2){let e=o.$implicit;C("show",e.visible),c("ngClass",e.type),l(),S(" ",e.message," ")}}function Z(s,o){s&1&&(i(0,"div"),a(1,"Le nom est requis."),r())}function $(s,o){s&1&&(i(0,"div"),a(1," Le nom doit comporter au moins 4 caract\xE8res. "),r())}function ee(s,o){if(s&1&&(i(0,"div",33),f(1,Z,2,0,"div",34)(2,$,2,0,"div",34),r()),s&2){d();let e=b(10);l(),c("ngIf",e.errors==null?null:e.errors.required),l(),c("ngIf",e.errors==null?null:e.errors.minlength)}}function te(s,o){if(s&1&&(i(0,"option",35),a(1),r()),s&2){let e=o.$implicit;c("ngValue",e.key),l(),S(" ",e.label," ")}}function ie(s,o){if(s&1){let e=M();i(0,"form",11,0),v("ngSubmit",function(){u(e);let t=d();return p(t.onSubmit())}),i(2,"div",12)(3,"div",13)(4,"label",14),a(5," Nom "),i(6,"span",15),a(7,"*"),r()(),i(8,"div",16)(9,"input",17,1),h("ngModelChange",function(t){u(e);let m=d();return _(m.user.nom,t)||(m.user.nom=t),p(t)}),r(),f(11,ee,3,2,"div",18),r()(),i(12,"div",13)(13,"label",19),a(14," Pr\xE9nom "),r(),i(15,"div",20)(16,"input",21,2),h("ngModelChange",function(t){u(e);let m=d();return _(m.user.prenom,t)||(m.user.prenom=t),p(t)}),r()(),i(18,"label",22),a(19," Fonction "),i(20,"span",15),a(21,"*"),r()(),i(22,"div",20)(23,"select",23),h("ngModelChange",function(t){u(e);let m=d();return _(m.user.fonction,t)||(m.user.fonction=t),p(t)}),i(24,"option",24),a(25,"-- S\xE9lectionnez une fonction --"),r(),f(26,te,2,2,"option",25),r()()(),i(27,"div",13)(28,"label",26),a(29," Email "),i(30,"span",15),a(31,"*"),r()(),i(32,"div",20)(33,"input",27,3),h("ngModelChange",function(t){u(e);let m=d();return _(m.user.email,t)||(m.user.email=t),p(t)}),r()(),i(35,"label",28),a(36," T\xE9l\xE9phone "),r(),i(37,"div",20)(38,"input",29,4),h("ngModelChange",function(t){u(e);let m=d();return _(m.user.telephone,t)||(m.user.telephone=t),p(t)}),r()()()(),i(40,"div",30)(41,"button",31),a(42),r(),i(43,"button",32),v("click",function(){u(e);let t=d();return p(t.close())}),a(44,"Fermer"),r()()()}if(s&2){let e=b(1),n=b(10),t=d();l(9),g("ngModel",t.user.nom),l(2),c("ngIf",n.invalid&&(n.dirty||n.touched)),l(5),g("ngModel",t.user.prenom),l(7),g("ngModel",t.user.fonction),l(3),c("ngForOf",t.fonctionUserList),l(7),g("ngModel",t.user.email),l(5),g("ngModel",t.user.telephone),l(3),c("disabled",!e.form.valid),l(),S(" ",t.bSaveName," ")}}function re(s,o){s&1&&(i(0,"h3",36),a(1,"Aucun Utilisateur \xE0 \xE9diter..."),r())}var X=class s{constructor(o,e,n){this.userService=o;this.router=e;this.dialog=n}user;isAddForm=!1;creationSuccess=!1;serverErrors=[];loading=!1;bSaveName="Enregistrer";toasts=[];showToast(o,e="success"){let n={message:o,type:e,visible:!1};this.toasts.push(n),requestAnimationFrame(()=>{n.visible=!0}),n.timeout=setTimeout(()=>this.closeToast(n),3e3)}closeToast(o){clearTimeout(o.timeout),o.visible=!1,setTimeout(()=>{this.toasts=this.toasts.filter(e=>e!==o)},400)}fonctionUserList=Object.values(I).map(o=>({key:o,label:N[o]}));ngOnInit(){this.isAddForm=!1,this.bSaveName="Enregistrer",this.user&&(this.router.url.includes("/create")||this.user.idUtilisateur==-1)&&(this.isAddForm=!0),this.isAddForm||(this.bSaveName="Modifier")}close(){this.router.navigate(["users/"])}onSubmit(){this.creationSuccess=!1,this.serverErrors=[],this.loading=!0,this.user&&(this.isAddForm?this.userService.createUser(this.user):this.userService.updateUser(this.user)).pipe(y(()=>this.loading=!1)).subscribe({next:e=>{e?(this.creationSuccess=!0,console.log("Sauvegarde r\xE9ussie",e),this.isAddForm?(this.user={idUtilisateur:0,nom:"",prenom:"",fonction:"",email:"",telephone:"",motDePasse:"",statut:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},this.showToast(["Sauvegarde r\xE9ussie !"],"success")):this.showToast(["Modification r\xE9ussie !"],"success")):this.showToast(["Une erreur est survenue lors de l'enregistrement"],"error")},error:e=>{this.serverErrors.push(e.error?.message||"Erreur inconnue."),this.showToast(this.serverErrors,"error")}})}static \u0275fac=function(e){return new(e||s)(x(G),x(V),x(J))};static \u0275cmp=w({type:s,selectors:[["app-user-form"]],inputs:{user:"user"},decls:4,vars:3,consts:[["userForm","ngForm"],["nom","ngModel"],["prenom","ngModel"],["email","ngModel"],["telephone","ngModel"],[1,"toast-container"],["class","toast",3,"ngClass","show",4,"ngFor","ngForOf"],["class","form-horizontal",3,"ngSubmit",4,"ngIf"],["class","center",4,"ngIf"],[1,"toast",3,"ngClass"],[1,"close-btn",3,"click"],[1,"form-horizontal",3,"ngSubmit"],[1,"card-body"],[1,"form-group","row"],["for","nom",1,"col-sm-2","col-form-label"],[1,"text-danger"],[1,"col-sm-10"],["type","text","id","nom","placeholder","Nom","required","","minlength","4","max","150","name","nom",1,"form-control",3,"ngModelChange","ngModel"],["class","alertInput",4,"ngIf"],["for","prenom",1,"col-sm-2","col-form-label"],[1,"col-sm-4"],["type","text","id","prenom","placeholder","Pr\xE9nom","maxlength","50","name","prenom",1,"form-control",3,"ngModelChange","ngModel"],["for","fonction",1,"col-sm-2","col-form-label"],["data-select2-id","1","tabindex","-1","aria-hidden","true","required","","name","fonction",1,"form-control","select2","select2-hidden-accessible",2,"width","100%",3,"ngModelChange","ngModel"],["value","-1","disabled","","selected",""],[3,"ngValue",4,"ngFor","ngForOf"],["for","email",1,"col-sm-2","col-form-label"],["type","text","id","email","required","","placeholder","Email","maxlength","50","name","email",1,"form-control",3,"ngModelChange","ngModel"],["for","telephone",1,"col-sm-2","col-form-label"],["type","text","id","telephone","placeholder","T\xE9l\xE9phone","maxlength","10","name","telephone",1,"form-control",3,"ngModelChange","ngModel"],[1,"card-footer"],["type","submit",1,"btn","btn-info",3,"disabled"],["type","button",1,"btn","btn-secondary","float-end",3,"click"],[1,"alertInput"],[4,"ngIf"],[3,"ngValue"],[1,"center"]],template:function(e,n){e&1&&(i(0,"div",5),f(1,Y,4,4,"div",6),r(),f(2,ie,45,9,"form",7)(3,re,2,0,"h3",8)),e&2&&(l(),c("ngForOf",n.toasts),l(),c("ngIf",n.user),l(),c("ngIf",!n.user))},dependencies:[T,E,F,U,H,A,q,z,O,k,P,W,B,R,j,L,D,K,Q],styles:[".toast-container[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;display:flex;flex-direction:column;gap:10px;z-index:9999}.toast[_ngcontent-%COMP%]{min-width:220px;padding:12px 16px;border-radius:6px;color:#fff;box-shadow:0 4px 12px #00000040;font-size:14px;display:flex;justify-content:space-between;align-items:center;opacity:0;transform:translate(100%);transition:transform .4s ease,opacity .4s ease}.toast.show[_ngcontent-%COMP%]{opacity:1;transform:translate(0)}.toast.success[_ngcontent-%COMP%]{background-color:#4caf50}.toast.error[_ngcontent-%COMP%]{background-color:#f44336}.toast[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;font-size:16px;line-height:1;cursor:pointer}"]})};export{X as a};
