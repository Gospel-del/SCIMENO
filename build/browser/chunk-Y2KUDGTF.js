import{b as R}from"./chunk-C5B75LPH.js";import{b as N,e as P,f as W,g as O,i as k,j as A,s as L,t as D,u as q,w as z}from"./chunk-LTEV2KH7.js";import{i as I}from"./chunk-NKZL4UVF.js";import{$b as f,Fb as b,Hb as x,I as y,Ib as c,Oa as a,Pc as E,Qc as F,Rc as T,Sb as C,Ub as M,Wb as m,Yb as S,Yc as V,Za as v,ac as g,bc as _,db as w,ha as d,ia as p,ib as h,vb as u,wb as i,xb as o}from"./chunk-S4NM23YD.js";function j(r,l){if(r&1){let e=b();i(0,"div",10),m(1),i(2,"button",11),x("click",function(){let t=d(e).$implicit,s=c();return p(s.closeToast(t))}),m(3,"\xD7"),o()()}if(r&2){let e=l.$implicit;M("show",e.visible),u("ngClass",e.type),a(),S(" ",e.message," ")}}function H(r,l){r&1&&(i(0,"div"),m(1,"Le nom est requis."),o())}function G(r,l){r&1&&(i(0,"div"),m(1," Le nom doit comporter au moins 4 caract\xE8res. "),o())}function U(r,l){if(r&1&&(i(0,"div",32),h(1,H,2,0,"div",33)(2,G,2,0,"div",33),o()),r&2){c();let e=C(10);a(),u("ngIf",e.errors==null?null:e.errors.required),a(),u("ngIf",e.errors==null?null:e.errors.minlength)}}function J(r,l){if(r&1){let e=b();i(0,"form",12,0),x("ngSubmit",function(){d(e);let t=c();return p(t.onSubmit())}),i(2,"div",13)(3,"div",14)(4,"label",15),m(5," Nom "),i(6,"span",16),m(7,"*"),o()(),i(8,"div",17)(9,"input",18,1),_("ngModelChange",function(t){d(e);let s=c();return g(s.client.nom,t)||(s.client.nom=t),p(t)}),o(),h(11,U,3,2,"div",19),o()(),i(12,"div",14)(13,"label",20),m(14," Pr\xE9nom "),o(),i(15,"div",21)(16,"input",22,2),_("ngModelChange",function(t){d(e);let s=c();return g(s.client.prenom,t)||(s.client.prenom=t),p(t)}),o()(),i(18,"label",23),m(19," Entreprise "),o(),i(20,"div",21)(21,"input",24,3),_("ngModelChange",function(t){d(e);let s=c();return g(s.client.entreprise,t)||(s.client.entreprise=t),p(t)}),o()()(),i(23,"div",14)(24,"label",25),m(25," Email "),i(26,"span",16),m(27,"*"),o()(),i(28,"div",21)(29,"input",26,4),_("ngModelChange",function(t){d(e);let s=c();return g(s.client.email,t)||(s.client.email=t),p(t)}),o()(),i(31,"label",27),m(32," T\xE9l\xE9phone "),o(),i(33,"div",21)(34,"input",28,5),_("ngModelChange",function(t){d(e);let s=c();return g(s.client.telephone,t)||(s.client.telephone=t),p(t)}),o()()()(),i(36,"div",29)(37,"button",30),m(38),o(),i(39,"button",31),x("click",function(){d(e);let t=c();return p(t.close())}),m(40,"Fermer"),o()()()}if(r&2){let e=C(1),n=C(10),t=c();a(9),f("ngModel",t.client.nom),a(2),u("ngIf",n.invalid&&(n.dirty||n.touched)),a(5),f("ngModel",t.client.prenom),a(5),f("ngModel",t.client.entreprise),a(8),f("ngModel",t.client.email),a(5),f("ngModel",t.client.telephone),a(3),u("disabled",!e.form.valid),a(),S(" ",t.bSaveName," ")}}function K(r,l){r&1&&(i(0,"h3",34),m(1,"Aucun client \xE0 \xE9diter..."),o())}var B=class r{constructor(l,e){this.clientService=l;this.router=e}client;isAddForm=!1;creationSuccess=!1;serverErrors=[];loading=!1;bSaveName="Enregistrer";toasts=[];showToast(l,e="success"){let n={message:l,type:e,visible:!1};this.toasts.push(n),requestAnimationFrame(()=>{n.visible=!0}),n.timeout=setTimeout(()=>this.closeToast(n),3e3)}closeToast(l){clearTimeout(l.timeout),l.visible=!1,setTimeout(()=>{this.toasts=this.toasts.filter(e=>e!==l)},400)}ngOnInit(){this.isAddForm=!1,this.bSaveName="Enregistrer",this.client&&(this.router.url.includes("/create")||this.client.idClient==-1)&&(this.isAddForm=!0),this.isAddForm||(this.bSaveName="Modifier")}close(){this.router.navigate(["clients/"])}onSubmit(){this.creationSuccess=!1,this.serverErrors=[],this.loading=!0,this.client&&(this.isAddForm?this.clientService.createClient(this.client):this.clientService.updateClient(this.client)).pipe(y(()=>this.loading=!1)).subscribe({next:e=>{e?(this.creationSuccess=!0,console.log("Sauvegarde r\xE9ussie",e),this.isAddForm?(this.client={idClient:0,nom:"",prenom:"",email:"",telephone:"",statut:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},this.showToast(["Sauvegarde r\xE9ussie !"],"success")):this.showToast(["Modification r\xE9ussie !"],"success")):this.showToast(["Une erreur est survenue lors de l'enregistrement"],"error")},error:e=>{this.serverErrors.push(e.error?.message||"Erreur inconnue."),this.showToast(this.serverErrors,"error")}})}static \u0275fac=function(e){return new(e||r)(v(R),v(I))};static \u0275cmp=w({type:r,selectors:[["app-clients-form"]],inputs:{client:"client"},decls:4,vars:3,consts:[["clientForm","ngForm"],["nom","ngModel"],["prenom","ngModel"],["entreprise","ngModel"],["email","ngModel"],["telephone","ngModel"],[1,"toast-container"],["class","toast",3,"ngClass","show",4,"ngFor","ngForOf"],["class","form-horizontal",3,"ngSubmit",4,"ngIf"],["class","center",4,"ngIf"],[1,"toast",3,"ngClass"],[1,"close-btn",3,"click"],[1,"form-horizontal",3,"ngSubmit"],[1,"card-body"],[1,"form-group","row"],["for","nom",1,"col-sm-2","col-form-label"],[1,"text-danger"],[1,"col-sm-10"],["type","text","id","nom","placeholder","Nom","required","","minlength","4","max","150","name","nom",1,"form-control",3,"ngModelChange","ngModel"],["class","alertInput",4,"ngIf"],["for","prenom",1,"col-sm-2","col-form-label"],[1,"col-sm-4"],["type","text","id","prenom","placeholder","Pr\xE9nom","maxlength","50","name","prenom",1,"form-control",3,"ngModelChange","ngModel"],["for","entreprise",1,"col-sm-2","col-form-label"],["type","text","id","entreprise","placeholder","Entreprise","maxlength","50","name","entreprise",1,"form-control",3,"ngModelChange","ngModel"],["for","email",1,"col-sm-2","col-form-label"],["type","text","id","email","required","","placeholder","Email","maxlength","50","name","email",1,"form-control",3,"ngModelChange","ngModel"],["for","telephone",1,"col-sm-2","col-form-label"],["type","text","id","telephone","placeholder","T\xE9l\xE9phone","maxlength","10","name","telephone",1,"form-control",3,"ngModelChange","ngModel"],[1,"card-footer"],["type","submit",1,"btn","btn-info",3,"disabled"],["type","button",1,"btn","btn-secondary","float-end",3,"click"],[1,"alertInput"],[4,"ngIf"],[1,"center"]],template:function(e,n){e&1&&(i(0,"div",6),h(1,j,4,4,"div",7),o(),h(2,J,41,8,"form",8)(3,K,2,0,"h3",9)),e&2&&(a(),u("ngForOf",n.toasts),a(),u("ngIf",n.client),a(),u("ngIf",!n.client))},dependencies:[V,E,F,T,z,A,N,P,W,L,D,q,k,O],styles:[".toast-container[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;display:flex;flex-direction:column;gap:10px;z-index:9999}.toast[_ngcontent-%COMP%]{min-width:220px;padding:12px 16px;border-radius:6px;color:#fff;box-shadow:0 4px 12px #00000040;font-size:14px;display:flex;justify-content:space-between;align-items:center;opacity:0;transform:translate(100%);transition:transform .4s ease,opacity .4s ease}.toast.show[_ngcontent-%COMP%]{opacity:1;transform:translate(0)}.toast.success[_ngcontent-%COMP%]{background-color:#4caf50}.toast.error[_ngcontent-%COMP%]{background-color:#f44336}.toast[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;font-size:16px;line-height:1;cursor:pointer}"]})};export{B as a};
