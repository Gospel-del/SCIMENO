import{c as O}from"./chunk-TND3ERBF.js";import{a as j,b as T,e as F,f as N,g as W,i as k,j as A,k as R,q as D,r as L,s as B,t as P,w as q}from"./chunk-LTEV2KH7.js";import{g as I,i as V}from"./chunk-NKZL4UVF.js";import{$b as _,Fb as b,Hb as x,Ib as d,Oa as l,Rc as M,Sb as E,Wb as s,Yb as y,Yc as w,Za as h,ac as g,bc as S,db as C,ha as m,ia as f,ib as v,vb as p,wb as i,xb as r,yb as u}from"./chunk-S4NM23YD.js";import"./chunk-CSTXWUWE.js";function G(c,t){c&1&&(i(0,"div",11),u(1,"i",12),i(2,"p"),s(3,"Chargement du sc\xE9nario..."),r()())}function z(c,t){if(c&1&&(i(0,"div",13),u(1,"i",14),s(2),r()),c&2){let e=d();l(2),y(" ",e.error," ")}}function H(c,t){c&1&&(i(0,"span"),s(1,"Sauvegarder les modifications"),r())}function J(c,t){c&1&&(i(0,"span"),u(1,"i",34),s(2," Sauvegarde en cours... "),r())}function K(c,t){if(c&1){let e=b();i(0,"form",15,0),x("ngSubmit",function(){m(e);let o=E(1),a=d();return f(a.onSubmit(o))}),i(2,"div",16)(3,"label",17),s(4,"Nom du sc\xE9nario *"),r(),i(5,"input",18),S("ngModelChange",function(o){m(e);let a=d();return g(a.scenario.nom_scenario,o)||(a.scenario.nom_scenario=o),f(o)}),r(),i(6,"small",19),s(7,"Le nom doit contenir au moins 3 caract\xE8res"),r()(),i(8,"div",16)(9,"label",20),s(10,"Coefficient de majoration *"),r(),i(11,"input",21),S("ngModelChange",function(o){m(e);let a=d();return g(a.scenario.coef_majoration,o)||(a.scenario.coef_majoration=o),f(o)}),r(),i(12,"small",19),s(13," Valeur entre 0 et 1 (ex: 0.15 = 15% de majoration) "),r()(),i(14,"div",16)(15,"label",22),s(16,"Description"),r(),i(17,"textarea",23),S("ngModelChange",function(o){m(e);let a=d();return g(a.scenario.description,o)||(a.scenario.description=o),f(o)}),r()(),i(18,"div",16)(19,"div",24)(20,"input",25),S("ngModelChange",function(o){m(e);let a=d();return g(a.scenario.actif,o)||(a.scenario.actif=o),f(o)}),r(),i(21,"label",26),s(22," Sc\xE9nario actif "),r()(),i(23,"small",19),s(24," Un sc\xE9nario actif peut \xEAtre utilis\xE9 dans les calculs "),r()(),i(25,"div",16)(26,"button",27),u(27,"i",28),v(28,H,2,0,"span",29)(29,J,3,0,"span",29),r(),i(30,"button",30),x("click",function(){m(e);let o=d();return f(o.onCancel())}),u(31,"i",31),s(32," Annuler "),r(),i(33,"button",32),x("click",function(){m(e);let o=E(1),a=d();return f(a.resetForm(o))}),u(34,"i",33),s(35," R\xE9initialiser "),r()()()}if(c&2){let e=E(1),n=d();l(5),_("ngModel",n.scenario.nom_scenario),l(6),_("ngModel",n.scenario.coef_majoration),l(6),_("ngModel",n.scenario.description),l(3),_("ngModel",n.scenario.actif),l(6),p("disabled",!e.valid||n.loading),l(2),p("ngIf",!n.loading),l(),p("ngIf",n.loading)}}var U=class c{constructor(t,e,n){this.scenariosService=t;this.router=e;this.route=n}scenario={id_scenario:0,nom_scenario:"",coef_majoration:0,description:"",actif:!0};loading=!1;error=null;scenarioId=null;ngOnInit(){this.route.params.subscribe(t=>{if(t.id)this.scenarioId=+t.id,this.loadScenario(this.scenarioId);else{let e=this.scenariosService.getScenarioToEdit();e?(this.scenarioId=e.id_scenario,this.loadScenarioFromModel(e)):this.error="Aucun sc\xE9nario \xE0 modifier"}})}loadScenario(t){this.loading=!0,this.error=null,this.scenariosService.getScenarioById(t).subscribe({next:e=>{e?this.loadScenarioFromModel(e):this.error="Sc\xE9nario non trouv\xE9",this.loading=!1},error:e=>{this.error="Erreur lors du chargement du sc\xE9nario",this.loading=!1,console.error("Erreur:",e)}})}loadScenarioFromModel(t){this.scenario={id_scenario:t.id_scenario,nom_scenario:t.nom_scenario,coef_majoration:t.coef_majoration,description:t.description||"",actif:t.actif},this.scenarioId=t.id_scenario}onSubmit(t){if(!t.invalid){if(!this.scenarioId){this.error="ID du sc\xE9nario manquant";return}if(this.loading=!0,this.error=null,this.scenario.coef_majoration!==void 0&&(this.scenario.coef_majoration<0||this.scenario.coef_majoration>1)){this.error="Le coefficient de majoration doit \xEAtre entre 0 et 1",this.loading=!1;return}this.scenariosService.updateScenario(this.scenario).subscribe({next:e=>{e?(this.scenariosService.clearScenarioToEdit(),this.router.navigate(["/scenarios"])):(this.error="Erreur lors de la modification du sc\xE9nario",this.loading=!1)},error:e=>{this.error=e.error?.message||"Erreur lors de la modification du sc\xE9nario",this.loading=!1,console.error("Erreur:",e)}})}}onCancel(){this.scenariosService.clearScenarioToEdit(),this.router.navigate(["/scenarios"])}resetForm(t){this.scenarioId&&this.loadScenario(this.scenarioId),this.error=null}static \u0275fac=function(e){return new(e||c)(h(O),h(V),h(I))};static \u0275cmp=C({type:c,selectors:[["app-scenarios-edit"]],decls:11,vars:3,consts:[["scenarioForm","ngForm"],[1,"row"],[1,"col-md-8"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"fas","fa-edit","mr-2"],[1,"card-body"],["class","text-center",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[3,"ngSubmit",4,"ngIf"],[1,"text-center"],[1,"fas","fa-spinner","fa-spin","fa-2x"],[1,"alert","alert-danger"],[1,"fas","fa-exclamation-triangle"],[3,"ngSubmit"],[1,"form-group"],["for","nom_scenario"],["type","text","id","nom_scenario","name","nom_scenario","required","","minlength","3","placeholder","Ex: Sc\xE9nario optimiste",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-text","text-muted"],["for","coef_majoration"],["type","number","id","coef_majoration","name","coef_majoration","required","","min","0","max","1","step","0.01","placeholder","Ex: 0.15 pour 15%",1,"form-control",3,"ngModelChange","ngModel"],["for","description"],["id","description","name","description","rows","4","placeholder","Description du sc\xE9nario (optionnel)",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-check"],["type","checkbox","id","actif","name","actif",1,"form-check-input",3,"ngModelChange","ngModel"],["for","actif",1,"form-check-label"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"fas","fa-save","mr-2"],[4,"ngIf"],["type","button",1,"btn","btn-secondary","ml-2",3,"click"],[1,"fas","fa-times","mr-2"],["type","button",1,"btn","btn-outline-secondary","ml-2",3,"click"],[1,"fas","fa-redo","mr-2"],[1,"fas","fa-spinner","fa-spin","mr-2"]],template:function(e,n){e&1&&(i(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h3",5),u(5,"i",6),s(6," Modifier le sc\xE9nario "),r()(),i(7,"div",7),v(8,G,4,0,"div",8)(9,z,3,1,"div",9)(10,K,36,7,"form",10),r()()()()),e&2&&(l(8),p("ngIf",n.loading&&!n.scenario.nom_scenario),l(),p("ngIf",n.error),l(),p("ngIf",!n.loading||n.scenario.nom_scenario))},dependencies:[w,M,q,A,T,R,j,F,N,B,P,L,D,k,W],encapsulation:2})};export{U as ScenariosEditComponent};
